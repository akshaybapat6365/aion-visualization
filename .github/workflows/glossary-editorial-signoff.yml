name: Glossary Editorial Signoff

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

jobs:
  glossary-signoff:
    runs-on: ubuntu-latest
    steps:
      - name: Detect glossary-related file changes
        id: filter
        uses: dorny/paths-filter@v3
        with:
          filters: |
            glossary:
              - 'src/data/glossary/**'
              - 'src/features/glossary/**'
              - 'scripts/consistency/check-term-canonicality.js'
              - 'src/chapter*.html'

      - name: Require editorial signoff in PR body
        if: steps.filter.outputs.glossary == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload.pull_request.body || '';
            const hasSignoff = /\[x\]\s*Glossary editorial signoff completed/.test(body);
            if (!hasSignoff) {
              core.setFailed('Glossary files changed. Please check "Glossary editorial signoff completed" in the PR template.');
            }
