<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessibility Audit - Aion Visualization</title>
    <style>
        :root {
            --bg-primary: #0A0A0A;
            --bg-secondary: #141414;
            --text-primary: #F0F0F0;
            --text-secondary: #8A8A8A;
            --accent: #FFD700;
            --success: #4CAF50;
            --error: #F44336;
            --warning: #FF9800;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        h1, h2 {
            font-weight: 300;
        }
        
        .audit-section {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }
        
        .audit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .audit-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .audit-item h3 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .status-pass { background: var(--success); }
        .status-fail { background: var(--error); }
        .status-warning { background: var(--warning); }
        .status-info { background: var(--accent); }
        
        .audit-details {
            margin-top: 1rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .audit-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .button {
            padding: 0.5rem 1rem;
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
        }
        
        .button:hover {
            opacity: 0.8;
        }
        
        .button-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--text-secondary);
        }
        
        .score-display {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .score-circle {
            width: 200px;
            height: 200px;
            margin: 0 auto 1rem;
            position: relative;
        }
        
        .score-circle svg {
            transform: rotate(-90deg);
        }
        
        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: 300;
        }
        
        .violations-list {
            list-style: none;
            padding: 0;
        }
        
        .violation-item {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
        }
        
        .violation-item code {
            background: rgba(0, 0, 0, 0.5);
            padding: 0.125rem 0.25rem;
            border-radius: 0.125rem;
            font-size: 0.875rem;
        }
        
        .loading {
            text-align: center;
            padding: 4rem;
            color: var(--text-secondary);
        }
        
        .recommendations {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid var(--accent);
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-top: 2rem;
        }
        
        .recommendations h3 {
            margin-top: 0;
            color: var(--accent);
        }
        
        .recommendations ul {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <h1>Accessibility Audit Dashboard</h1>
    <p>Comprehensive WCAG 2.1 compliance testing for Aion Visualization</p>
    
    <div class="score-display">
        <div class="score-circle">
            <svg width="200" height="200">
                <circle cx="100" cy="100" r="90" fill="none" stroke="#1F1F1F" stroke-width="20"/>
                <circle cx="100" cy="100" r="90" fill="none" stroke="#FFD700" stroke-width="20"
                        stroke-dasharray="565.48" stroke-dashoffset="565.48" id="score-circle"/>
            </svg>
            <div class="score-text" id="score-text">0%</div>
        </div>
        <h2>Overall Accessibility Score</h2>
        <p id="score-summary">Analyzing...</p>
    </div>
    
    <div class="audit-section">
        <h2>Quick Tests</h2>
        <div class="audit-grid">
            <div class="audit-item">
                <h3><span class="status-indicator" id="status-contrast"></span> Color Contrast</h3>
                <div class="audit-details" id="details-contrast">Checking contrast ratios...</div>
                <div class="audit-actions">
                    <button class="button button-secondary" onclick="testContrast()">Re-test</button>
                </div>
            </div>
            
            <div class="audit-item">
                <h3><span class="status-indicator" id="status-keyboard"></span> Keyboard Navigation</h3>
                <div class="audit-details" id="details-keyboard">Testing keyboard accessibility...</div>
                <div class="audit-actions">
                    <button class="button button-secondary" onclick="testKeyboard()">Re-test</button>
                </div>
            </div>
            
            <div class="audit-item">
                <h3><span class="status-indicator" id="status-aria"></span> ARIA Implementation</h3>
                <div class="audit-details" id="details-aria">Checking ARIA attributes...</div>
                <div class="audit-actions">
                    <button class="button button-secondary" onclick="testARIA()">Re-test</button>
                </div>
            </div>
            
            <div class="audit-item">
                <h3><span class="status-indicator" id="status-headings"></span> Heading Structure</h3>
                <div class="audit-details" id="details-headings">Analyzing heading hierarchy...</div>
                <div class="audit-actions">
                    <button class="button button-secondary" onclick="testHeadings()">Re-test</button>
                </div>
            </div>
            
            <div class="audit-item">
                <h3><span class="status-indicator" id="status-images"></span> Image Alt Text</h3>
                <div class="audit-details" id="details-images">Checking image descriptions...</div>
                <div class="audit-actions">
                    <button class="button button-secondary" onclick="testImages()">Re-test</button>
                </div>
            </div>
            
            <div class="audit-item">
                <h3><span class="status-indicator" id="status-forms"></span> Form Labels</h3>
                <div class="audit-details" id="details-forms">Validating form accessibility...</div>
                <div class="audit-actions">
                    <button class="button button-secondary" onclick="testForms()">Re-test</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="audit-section">
        <h2>Automated Tests</h2>
        <div class="loading" id="automated-loading">
            Running automated accessibility tests...
        </div>
        <div id="automated-results" style="display: none;">
            <h3>Violations Found</h3>
            <ul class="violations-list" id="violations-list"></ul>
        </div>
    </div>
    
    <div class="audit-section">
        <h2>Manual Testing Checklist</h2>
        <div class="audit-grid">
            <div class="audit-item">
                <h3>üñ±Ô∏è Screen Reader Testing</h3>
                <ul>
                    <li><input type="checkbox"> Test with NVDA/JAWS (Windows)</li>
                    <li><input type="checkbox"> Test with VoiceOver (macOS/iOS)</li>
                    <li><input type="checkbox"> Test with TalkBack (Android)</li>
                    <li><input type="checkbox"> All content is announced properly</li>
                    <li><input type="checkbox"> Interactive elements have clear labels</li>
                </ul>
            </div>
            
            <div class="audit-item">
                <h3>‚å®Ô∏è Keyboard-Only Navigation</h3>
                <ul>
                    <li><input type="checkbox"> Tab through all interactive elements</li>
                    <li><input type="checkbox"> Focus indicators are visible</li>
                    <li><input type="checkbox"> No keyboard traps</li>
                    <li><input type="checkbox"> Skip links work correctly</li>
                    <li><input type="checkbox"> Custom shortcuts don't conflict</li>
                </ul>
            </div>
            
            <div class="audit-item">
                <h3>üé® Visual Testing</h3>
                <ul>
                    <li><input type="checkbox"> 200% zoom without horizontal scroll</li>
                    <li><input type="checkbox"> Text spacing adjustments work</li>
                    <li><input type="checkbox"> High contrast mode is effective</li>
                    <li><input type="checkbox"> Focus indicators meet contrast ratio</li>
                    <li><input type="checkbox"> No information conveyed by color alone</li>
                </ul>
            </div>
            
            <div class="audit-item">
                <h3>üì± Mobile Accessibility</h3>
                <ul>
                    <li><input type="checkbox"> Touch targets ‚â• 44x44px</li>
                    <li><input type="checkbox"> Pinch-to-zoom enabled</li>
                    <li><input type="checkbox"> Portrait/landscape orientation works</li>
                    <li><input type="checkbox"> Gestures have alternatives</li>
                    <li><input type="checkbox"> Voice control compatible</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="recommendations">
        <h3>Recommendations</h3>
        <ul id="recommendations-list">
            <li>Enable the accessibility features panel for users</li>
            <li>Add audio descriptions for complex visualizations</li>
            <li>Implement language selection for internationalization</li>
            <li>Create accessible data tables for chapter information</li>
        </ul>
    </div>
    
    <div class="audit-section">
        <h2>Actions</h2>
        <button class="button" onclick="runFullAudit()">Run Full Audit</button>
        <button class="button button-secondary" onclick="exportReport()">Export Report</button>
        <button class="button button-secondary" onclick="window.print()">Print Report</button>
    </div>
    
    <script>
        // Accessibility testing functions
        let auditResults = {
            score: 0,
            passed: 0,
            failed: 0,
            warnings: 0,
            violations: []
        };
        
        async function runFullAudit() {
            // Reset results
            auditResults = {
                score: 0,
                passed: 0,
                failed: 0,
                warnings: 0,
                violations: []
            };
            
            // Run all tests
            await Promise.all([
                testContrast(),
                testKeyboard(),
                testARIA(),
                testHeadings(),
                testImages(),
                testForms()
            ]);
            
            // Load axe-core for automated testing
            if (typeof axe === 'undefined') {
                await loadAxeCore();
            }
            
            // Run automated tests
            await runAutomatedTests();
            
            // Calculate score
            updateScore();
        }
        
        function testContrast() {
            const results = checkColorContrast();
            updateTestStatus('contrast', results);
            return Promise.resolve();
        }
        
        function testKeyboard() {
            const results = checkKeyboardNav();
            updateTestStatus('keyboard', results);
            return Promise.resolve();
        }
        
        function testARIA() {
            const results = checkARIA();
            updateTestStatus('aria', results);
            return Promise.resolve();
        }
        
        function testHeadings() {
            const results = checkHeadings();
            updateTestStatus('headings', results);
            return Promise.resolve();
        }
        
        function testImages() {
            const results = checkImages();
            updateTestStatus('images', results);
            return Promise.resolve();
        }
        
        function testForms() {
            const results = checkForms();
            updateTestStatus('forms', results);
            return Promise.resolve();
        }
        
        // Test implementations
        function checkColorContrast() {
            // Simple contrast check (in production, use proper WCAG algorithm)
            const elements = document.querySelectorAll('*');
            let issues = 0;
            let checked = 0;
            
            elements.forEach(el => {
                const style = window.getComputedStyle(el);
                const bg = style.backgroundColor;
                const fg = style.color;
                
                if (bg !== 'rgba(0, 0, 0, 0)' && fg !== 'rgba(0, 0, 0, 0)') {
                    checked++;
                    // Simplified check - in reality, calculate actual contrast ratio
                    const isDark = bg.includes('0, 0, 0') || bg.includes('10, 10, 10');
                    const isLight = fg.includes('255, 255, 255') || fg.includes('240, 240, 240');
                    
                    if (isDark && !isLight) {
                        issues++;
                    }
                }
            });
            
            return {
                status: issues === 0 ? 'pass' : issues < 5 ? 'warning' : 'fail',
                details: `Checked ${checked} elements, found ${issues} potential contrast issues`
            };
        }
        
        function checkKeyboardNav() {
            const focusable = document.querySelectorAll(
                'a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])'
            );
            
            const noTabindex = Array.from(focusable).filter(el => 
                !el.hasAttribute('tabindex') || el.getAttribute('tabindex') >= 0
            );
            
            return {
                status: noTabindex.length === focusable.length ? 'pass' : 'warning',
                details: `${focusable.length} focusable elements, ${noTabindex.length} keyboard accessible`
            };
        }
        
        function checkARIA() {
            const ariaElements = document.querySelectorAll('[role], [aria-label], [aria-describedby]');
            const landmarks = document.querySelectorAll('[role="navigation"], [role="main"], [role="banner"]');
            
            return {
                status: landmarks.length >= 2 ? 'pass' : 'warning',
                details: `${ariaElements.length} ARIA elements, ${landmarks.length} landmarks`
            };
        }
        
        function checkHeadings() {
            const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
            const h1Count = document.querySelectorAll('h1').length;
            
            // Check heading order
            let previousLevel = 0;
            let skipped = false;
            
            headings.forEach(h => {
                const level = parseInt(h.tagName[1]);
                if (level > previousLevel + 1) {
                    skipped = true;
                }
                previousLevel = level;
            });
            
            return {
                status: h1Count === 1 && !skipped ? 'pass' : 'warning',
                details: `${headings.length} headings, ${h1Count} H1 tags, ${skipped ? 'skipped levels' : 'proper hierarchy'}`
            };
        }
        
        function checkImages() {
            const images = document.querySelectorAll('img');
            const withAlt = document.querySelectorAll('img[alt]');
            const decorative = document.querySelectorAll('img[alt=""]');
            
            const missing = images.length - withAlt.length;
            
            return {
                status: missing === 0 ? 'pass' : missing <= 2 ? 'warning' : 'fail',
                details: `${images.length} images, ${withAlt.length} with alt text, ${decorative.length} marked decorative`
            };
        }
        
        function checkForms() {
            const inputs = document.querySelectorAll('input, textarea, select');
            const labeled = document.querySelectorAll('input[id], textarea[id], select[id]');
            
            let properlyLabeled = 0;
            labeled.forEach(input => {
                const label = document.querySelector(`label[for="${input.id}"]`);
                if (label || input.getAttribute('aria-label')) {
                    properlyLabeled++;
                }
            });
            
            return {
                status: properlyLabeled === inputs.length ? 'pass' : 'warning',
                details: `${inputs.length} form elements, ${properlyLabeled} properly labeled`
            };
        }
        
        function updateTestStatus(test, results) {
            const statusEl = document.getElementById(`status-${test}`);
            const detailsEl = document.getElementById(`details-${test}`);
            
            statusEl.className = `status-indicator status-${results.status}`;
            detailsEl.textContent = results.details;
            
            // Update counts
            if (results.status === 'pass') auditResults.passed++;
            else if (results.status === 'fail') auditResults.failed++;
            else auditResults.warnings++;
        }
        
        async function loadAxeCore() {
            return new Promise((resolve) => {
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/axe-core/4.7.2/axe.min.js';
                script.onload = resolve;
                document.head.appendChild(script);
            });
        }
        
        async function runAutomatedTests() {
            const loadingEl = document.getElementById('automated-loading');
            const resultsEl = document.getElementById('automated-results');
            
            try {
                const results = await axe.run();
                
                loadingEl.style.display = 'none';
                resultsEl.style.display = 'block';
                
                const violationsList = document.getElementById('violations-list');
                violationsList.innerHTML = '';
                
                if (results.violations.length === 0) {
                    violationsList.innerHTML = '<li style="color: var(--success);">No automated violations found!</li>';
                } else {
                    results.violations.forEach(violation => {
                        const li = document.createElement('li');
                        li.className = 'violation-item';
                        li.innerHTML = `
                            <strong>${violation.description}</strong><br>
                            <code>${violation.id}</code> - Impact: ${violation.impact}<br>
                            <small>${violation.nodes.length} instance(s) found</small>
                        `;
                        violationsList.appendChild(li);
                    });
                }
                
                auditResults.violations = results.violations;
                
            } catch (error) {
                loadingEl.textContent = 'Error running automated tests: ' + error.message;
            }
        }
        
        function updateScore() {
            const total = auditResults.passed + auditResults.failed + auditResults.warnings;
            const score = Math.round((auditResults.passed / total) * 100);
            
            auditResults.score = score;
            
            // Update display
            document.getElementById('score-text').textContent = score + '%';
            document.getElementById('score-summary').textContent = 
                `${auditResults.passed} passed, ${auditResults.warnings} warnings, ${auditResults.failed} failed`;
            
            // Update circle
            const circle = document.getElementById('score-circle');
            const circumference = 2 * Math.PI * 90;
            const offset = circumference - (score / 100) * circumference;
            
            circle.style.strokeDashoffset = offset;
            circle.style.transition = 'stroke-dashoffset 1s ease';
            
            // Update color based on score
            if (score >= 90) {
                circle.style.stroke = '#4CAF50';
            } else if (score >= 70) {
                circle.style.stroke = '#FF9800';
            } else {
                circle.style.stroke = '#F44336';
            }
        }
        
        function exportReport() {
            const report = {
                timestamp: new Date().toISOString(),
                url: window.location.href,
                score: auditResults.score,
                summary: {
                    passed: auditResults.passed,
                    warnings: auditResults.warnings,
                    failed: auditResults.failed
                },
                violations: auditResults.violations,
                userAgent: navigator.userAgent
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `accessibility-audit-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }
        
        // Run initial audit on load
        window.addEventListener('load', () => {
            setTimeout(runFullAudit, 1000);
        });
    </script>
</body>
</html>