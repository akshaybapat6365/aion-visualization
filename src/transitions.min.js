class PageTransitions{constructor(){this.transitioning=false;this.init();}init(){this.createOverlay();this.setupLinkInterception();window.addEventListener('popstate',()=>this.handlePopState());this.animatePageIn();}createOverlay(){const overlay=document.createElement('div');overlay.className='page-transition-overlay';overlay.innerHTML=`<style>.page-transition-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:10000;pointer-events:none;transform:translateY(100%);}.page-transition-overlay.active{pointer-events:all;}@keyframes slideUp{from{transform:translateY(100%);}to{transform:translateY(0);}}@keyframes slideDown{from{transform:translateY(0);}to{transform:translateY(-100%);}}.page-content-fade{animation:contentFadeIn 0.6s ease-out;}@keyframes contentFadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}</style>`;document.body.appendChild(overlay);this.overlay=overlay;}setupLinkInterception(){document.addEventListener('click',(e)=>{const link=e.target.closest('a');if(!link||this.transitioning)return;const href=link.getAttribute('href');if(!href||href.startsWith('http')||href.startsWith('#'))return;if(!href.endsWith('.html'))return;e.preventDefault();this.navigateTo(href);});}async navigateTo(url){if(this.transitioning)return;this.transitioning=true;await this.animatePageOut();try{const response=await fetch(url);const html=await response.text();const parser=new DOMParser();const newDoc=parser.parseFromString(html,'text/html');document.title=newDoc.title;const newBody=newDoc.body.innerHTML;const scripts=document.querySelectorAll('script');const overlay=this.overlay;document.body.innerHTML=newBody;document.body.appendChild(overlay);const newScripts=newDoc.querySelectorAll('script');newScripts.forEach(script=>{const newScript=document.createElement('script');if(script.src){newScript.src=script.src;}else{newScript.textContent=script.textContent;}document.body.appendChild(newScript);});window.history.pushState({},'',url);this.setupLinkInterception();await this.animatePageIn();}catch(error){console.error('Navigation error:',error);window.location.href=url;}this.transitioning=false;}animatePageOut(){return new Promise(resolve=>{const content=document.querySelector('main,section,.container');if(content){content.style.opacity='0';content.style.transform='translateY(-20px)';content.style.transition='all 0.3s ease-out';}this.overlay.classList.add('active');this.overlay.style.animation='slideUp 0.4s ease-out forwards';setTimeout(resolve,400);});}animatePageIn(){return new Promise(resolve=>{this.overlay.style.animation='slideDown 0.4s ease-out forwards';setTimeout(()=>{this.overlay.classList.remove('active');const content=document.querySelector('main,section,.chapter-hero');if(content){content.classList.add('page-content-fade');}if(window.initPage){window.initPage();}resolve();},400);});}handlePopState(){if(!this.transitioning){this.navigateTo(window.location.pathname);}}}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{new PageTransitions();});}else{new PageTransitions();}