class OptimizedWebGLManager{constructor(){this.scene=null;this.camera=null;this.renderer=null;this.animationFrame=null;this.isInitialized=false;this.memoryMonitor={geometries:0,materials:0,textures:0};}async init(canvas){if(this.isInitialized)return;try{if(!this.checkWebGLSupport()){return this.initFallback(canvas);}const THREE=await this.loadThreeJS();this.scene=new THREE.Scene();this.camera=new THREE.PerspectiveCamera(75,canvas.width/canvas.height,0.1,1000);this.renderer=new THREE.WebGLRenderer({canvas:canvas,antialias:false,powerPreference:'default'});this.isInitialized=true;}catch(error){console.error('WebGL initialization failed:',error);return this.initFallback(canvas);}}checkWebGLSupport(){try{const canvas=document.createElement('canvas');return!!(window.WebGLRenderingContext&&canvas.getContext('webgl'));}catch(e){return false;}}async loadThreeJS(){if(window.THREE)return window.THREE;return new Promise((resolve,reject)=>{const script=document.createElement('script');script.src='https:script.onload=()=>resolve(window.THREE);script.onerror=reject;document.head.appendChild(script);});}initFallback(canvas){const ctx=canvas.getContext('2d');this.renderFallback(ctx);return{fallback:true};}renderFallback(ctx){ctx.fillStyle='#1a1a1a';ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height);ctx.fillStyle='#ffd700';ctx.font='24px Arial';ctx.textAlign='center';ctx.fillText('Visualization Loading...',ctx.canvas.width/2,ctx.canvas.height/2);}dispose(){if(this.animationFrame){cancelAnimationFrame(this.animationFrame);}if(this.renderer){this.renderer.dispose();}if(this.scene){this.scene.clear();}this.isInitialized=false;}getMemoryUsage(){if(!this.renderer)return null;return{geometries:this.renderer.info.memory.geometries,textures:this.renderer.info.memory.textures,programs:this.renderer.info.programs?.length||0};}}window.OptimizedWebGLManager=new OptimizedWebGLManager();