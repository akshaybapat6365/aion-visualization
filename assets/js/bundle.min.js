/* Aion Visualization - Core JS Bundle */

/* github-pages-router.js */
class GitHubPagesRouter{constructor(){this.baseUrl='/aion-visualization';this.routes=new Map();this.currentRoute=null;this.isInitialized=false;this.historySupported=!!(window.history&&history.pushState);this.routePatterns={home:/^\/$/,chapters:/^\/chapters\/$/,chapterEnhanced:/^\/chapters\/enhanced\/(\d+)\/$/,chapterStandard:/^\/chapters\/standard\/(\d+)\/$/,timeline:/^\/timeline\/$/,symbols:/^\/symbols\/$/,about:/^\/about\/$/};this.init();}init(){if(this.isInitialized)return;try{this.setupRoutes();this.handleInitialRoute();this.bindEvents();this.updateNavigationLinks();this.isInitialized=true;}catch(error){console.error('Router initialization failed:',error);this.fallbackToOriginalUrls();}}setupRoutes(){this.routes.set('/','index.html');this.routes.set('/chapters/','chapters/index.html');this.routes.set('/timeline/','src/timeline.html');this.routes.set('/symbols/','src/symbols.html');this.routes.set('/about/','src/about.html');for(let i=1;i<=14;i++){this.routes.set(`/chapters/enhanced/${i}/`,`chapters/enhanced/chapter-${i}.html`);}for(let i=1;i<=14;i++){this.routes.set(`/chapters/standard/${i}/`,`chapters/standard/chapter-${i}.html`);}}handleInitialRoute(){const currentPath=this.getCurrentPath();if(this.isCleanUrl(currentPath)){this.handleRoute(currentPath);return;}const cleanUrl=this.getCleanUrlForCurrentPage();if(cleanUrl&&cleanUrl!==currentPath){this.redirectToCleanUrl(cleanUrl);return;}this.handleLegacyUrl(currentPath);}getCurrentPath(){let path=window.location.pathname;if(path.startsWith(this.baseUrl)){path=path.substring(this.baseUrl.length);}if(!path.startsWith('/')){path='/'+path;}return path;}isCleanUrl(path){return Object.values(this.routePatterns).some(pattern=>pattern.test(path));}getCleanUrlForCurrentPage(){const path=this.getCurrentPath();const cleanUrlMappings={'/index.html':'/','/chapters/index.html':'/chapters/','/src/timeline.html':'/timeline/','/src/symbols.html':'/symbols/','/src/about.html':'/about/'};const chapterMatch=path.match(/\/chapters\/(enhanced|standard)\/chapter-(\d+)\.html$/);if(chapterMatch){const[,type,number]=chapterMatch;return `/chapters/${type}/${number}/`;}return cleanUrlMappings[path]||null;}redirectToCleanUrl(cleanUrl){if(this.historySupported){history.replaceState(null,null,this.baseUrl+cleanUrl);this.handleRoute(cleanUrl);}else{window.location.href=this.baseUrl+cleanUrl;}}handleLegacyUrl(path){const legacyChapterMatch=path.match(/\/chapter(\d+)\.html$/);if(legacyChapterMatch){const chapterNum=legacyChapterMatch[1];const cleanUrl=`/chapters/enhanced/${chapterNum}/`;this.redirectToCleanUrl(cleanUrl);return;}const legacyMappings={'/chapters.html':'/chapters/','/timeline.html':'/timeline/','/symbols.html':'/symbols/','/about.html':'/about/'};const cleanUrl=legacyMappings[path];if(cleanUrl){this.redirectToCleanUrl(cleanUrl);}}handleRoute(path){const actualFile=this.routes.get(path);if(!actualFile){const matchedRoute=this.findMatchingRoute(path);if(matchedRoute){this.loadContent(matchedRoute.file,matchedRoute.params);return;}return;}this.loadContent(actualFile);}findMatchingRoute(path){const enhancedMatch=path.match(this.routePatterns.chapterEnhanced);if(enhancedMatch){const chapterNum=enhancedMatch[1];if(chapterNum>=1&&chapterNum<=14){return{file:`chapters/enhanced/chapter-${chapterNum}.html`,params:{type:'enhanced',chapter:chapterNum}};}}const standardMatch=path.match(this.routePatterns.chapterStandard);if(standardMatch){const chapterNum=standardMatch[1];if(chapterNum>=1&&chapterNum<=14){return{file:`chapters/standard/chapter-${chapterNum}.html`,params:{type:'standard',chapter:chapterNum}};}}return null;}loadContent(filePath,params={}){const fullUrl=this.baseUrl+'/'+filePath;if(this.historySupported){this.fetchAndUpdateContent(fullUrl,params);}else{window.location.href=fullUrl;}}async fetchAndUpdateContent(url,params={}){try{const response=await fetch(url);if(!response.ok){throw new Error(`HTTP ${response.status}:${response.statusText}`);}const html=await response.text();this.updatePageContent(html,params);}catch(error){console.error('Failed to load content:',error);window.location.href=url;}}updatePageContent(html,params={}){const parser=new DOMParser();const doc=parser.parseFromString(html,'text/html');const newTitle=doc.querySelector('title');if(newTitle){document.title=newTitle.textContent;}const newDescription=doc.querySelector('meta[name="description"]');const existingDescription=document.querySelector('meta[name="description"]');if(newDescription&&existingDescription){existingDescription.setAttribute('content',newDescription.getAttribute('content'));}const newMain=doc.querySelector('main')||doc.querySelector('body');const existingMain=document.querySelector('main')||document.querySelector('body');if(newMain&&existingMain){const nav=existingMain.querySelector('nav');existingMain.innerHTML=newMain.innerHTML;if(nav){existingMain.prepend(nav);}}this.executeScripts(doc);this.updateNavigationActiveState();this.dispatchRouteChangeEvent(params);}executeScripts(doc){const scripts=doc.querySelectorAll('script');scripts.forEach(script=>{if(script.src){const newScript=document.createElement('script');newScript.src=script.src;newScript.async=true;document.head.appendChild(newScript);}else if(script.textContent){try{eval(script.textContent);}catch(error){}}});}bindEvents(){window.addEventListener('popstate',(event)=>{const path=this.getCurrentPath();this.handleRoute(path);});document.addEventListener('click',(event)=>{const link=event.target.closest('a[href]');if(!link)return;const href=link.getAttribute('href');if(this.shouldInterceptLink(href)){event.preventDefault();this.navigateTo(href);}});document.addEventListener('submit',(event)=>{const form=event.target;if(form.hasAttribute('data-clean-url')){event.preventDefault();this.handleFormSubmission(form);}});}shouldInterceptLink(href){if(!href||href.startsWith('#')||href.startsWith('mailto:')||href.startsWith('tel:')){return false;}if(href.startsWith('http')&&!href.includes('github.io/aion-visualization')){return false;}return true;}navigateTo(path){const cleanPath=this.getCleanUrlForPath(path);const fullPath=cleanPath||path;if(this.historySupported){history.pushState(null,null,this.baseUrl+fullPath);this.handleRoute(fullPath);}else{window.location.href=this.baseUrl+fullPath;}}getCleanUrlForPath(path){if(path.startsWith(this.baseUrl)){path=path.substring(this.baseUrl.length);}const cleanMappings={'/index.html':'/','/chapters/index.html':'/chapters/','/src/timeline.html':'/timeline/','/src/symbols.html':'/symbols/','/src/about.html':'/about/'};const chapterMatch=path.match(/\/chapters\/(enhanced|standard)\/chapter-(\d+)\.html$/);if(chapterMatch){const[,type,number]=chapterMatch;return `/chapters/${type}/${number}/`;}return cleanMappings[path]||path;}updateNavigationLinks(){const navLinks=document.querySelectorAll('nav a[href]');navLinks.forEach(link=>{const href=link.getAttribute('href');const cleanUrl=this.getCleanUrlForPath(href);if(cleanUrl&&cleanUrl!==href){link.setAttribute('href',cleanUrl);link.setAttribute('data-original-href',href);}});}updateNavigationActiveState(){const currentPath=this.getCurrentPath();const navLinks=document.querySelectorAll('nav a[href]');navLinks.forEach(link=>{const href=link.getAttribute('href');const isActive=href===currentPath||(href!=='/'&&currentPath.startsWith(href));link.classList.toggle('active',isActive);});}handleFormSubmission(form){const formData=new FormData(form);const action=form.getAttribute('action')||'';const method=form.getAttribute('method')||'GET';if(method.toLowerCase()==='get'){const params=new URLSearchParams(formData);const cleanUrl=this.getCleanUrlForPath(action);const fullUrl=`${cleanUrl}?${params.toString()}`;this.navigateTo(fullUrl);}}dispatchRouteChangeEvent(params={}){const event=new CustomEvent('routechange',{detail:{path:this.getCurrentPath(),params:params,timestamp:Date.now()}});window.dispatchEvent(event);}fallbackToOriginalUrls(){const links=document.querySelectorAll('a[data-original-href]');links.forEach(link=>{const originalHref=link.getAttribute('data-original-href');link.setAttribute('href',originalHref);link.removeAttribute('data-original-href');});}getCurrentRoute(){return this.getCurrentPath();}isRouteActive(path){const currentPath=this.getCurrentPath();return currentPath===path||(path!=='/'&&currentPath.startsWith(path));}getRouteParams(){const path=this.getCurrentPath();const matchedRoute=this.findMatchingRoute(path);return matchedRoute?matchedRoute.params:{};}static generateCleanUrl(type,params={}){switch(type){case 'chapter':const chapterType=params.type||'enhanced';const chapterNum=params.chapter||1;return `/chapters/${chapterType}/${chapterNum}/`;case 'chapters':return '/chapters/';case 'timeline':return '/timeline/';case 'symbols':return '/symbols/';case 'about':return '/about/';default:return '/';}}}document.addEventListener('DOMContentLoaded',()=>{window.githubPagesRouter=new GitHubPagesRouter();});window.GitHubPagesRouter=GitHubPagesRouter;if(typeof module!=='undefined'&&module.exports){module.exports=GitHubPagesRouter;}
/* consolidated-utilities.js */
const AionUtils={dom:{get(selector){try{return document.querySelector(selector);}catch(error){return null;}},getAll(selector){try{return document.querySelectorAll(selector);}catch(error){return[];}},on(element,event,handler){if(!element)return;try{element.addEventListener(event,(e)=>{try{handler(e);}catch(error){console.error('Event handler error:',error);AionUtils.errors.show('An error occurred while handling the event');}});}catch(error){console.error('Failed to add event listener:',error);}},off(element,event,handler){if(!element)return;try{element.removeEventListener(event,handler);}catch(error){}},create(tag,attributes={},content=''){try{const element=document.createElement(tag);Object.keys(attributes).forEach(attr=>{element.setAttribute(attr,attributes[attr]);});if(content){element.innerHTML=content;}return element;}catch(error){console.error('Failed to create element:',error);return null;}}},animation:{scrollTo(element,duration=500){if(!element)return;const start=window.pageYOffset;const target=element.offsetTop;const distance=target-start;let startTime=null;const animate=(currentTime)=>{if(startTime===null)startTime=currentTime;const timeElapsed=currentTime-startTime;const progress=Math.min(timeElapsed/duration,1);const ease=progress*(2-progress);window.scrollTo(0,start+distance*ease);if(progress<1){requestAnimationFrame(animate);}};requestAnimationFrame(animate);},fadeIn(element,duration=300){if(!element)return Promise.resolve();return new Promise(resolve=>{element.style.opacity='0';element.style.transition=`opacity ${duration}ms`;requestAnimationFrame(()=>{element.style.opacity='1';setTimeout(resolve,duration);});});},fadeOut(element,duration=300){if(!element)return Promise.resolve();return new Promise(resolve=>{element.style.transition=`opacity ${duration}ms`;element.style.opacity='0';setTimeout(resolve,duration);});}},storage:{get(key,defaultValue=null){try{const value=localStorage.getItem(key);return value?JSON.parse(value):defaultValue;}catch(error){return defaultValue;}},set(key,value){try{localStorage.setItem(key,JSON.stringify(value));return true;}catch(error){return false;}},remove(key){try{localStorage.removeItem(key);return true;}catch(error){return false;}}},network:{async fetch(url,options={}){const defaultOptions={timeout:10000,headers:{'Content-Type':'application/json'}};const config={...defaultOptions,...options};const controller=new AbortController();const timeoutId=setTimeout(()=>controller.abort(),config.timeout);try{const response=await fetch(url,{...config,signal:controller.signal});clearTimeout(timeoutId);if(!response.ok){throw new Error(`HTTP ${response.status}:${response.statusText}`);}return response;}catch(error){clearTimeout(timeoutId);if(error.name==='AbortError'){throw new Error('Request timeout');}throw error;}},isOnline(){return navigator.onLine;},onNetworkChange(callback){window.addEventListener('online',()=>callback(true));window.addEventListener('offline',()=>callback(false));}},errors:{show(message,type='error'){const container=this.getContainer();const errorElement=AionUtils.dom.create('div',{class:`error-message error-${type}`,role:'alert'},`<span class="error-icon">⚠️</span><span class="error-text">${message}</span><button class="error-close" onclick="this.parentElement.remove()">×</button>`);container.appendChild(errorElement);setTimeout(()=>{if(errorElement.parentElement){errorElement.remove();}},5000);},getContainer(){let container=AionUtils.dom.get('#error-container');if(!container){container=AionUtils.dom.create('div',{id:'error-container',class:'error-container'});document.body.appendChild(container);}return container;},log(error,context=''){const errorInfo={message:error.message,stack:error.stack,context:context,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,url:window.location.href};console.error('Application Error:',errorInfo);const errors=AionUtils.storage.get('debug_errors',[]);errors.push(errorInfo);if(errors.length>10)errors.shift();AionUtils.storage.set('debug_errors',errors);}},validation:{isEmail(email){const pattern=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return pattern.test(email);},isUrl(url){try{new URL(url);return true;}catch{return false;}},isInRange(value,min,max){const num=parseFloat(value);return!isNaN(num)&&num>=min&&num<=max;}},performance:{debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};},throttle(func,limit){let inThrottle;return function executedFunction(...args){if(!inThrottle){func(...args);inThrottle=true;setTimeout(()=>inThrottle=false,limit);}};},measure(name,func){const start=performance.now();const result=func();const end=performance.now();.toFixed(2)}ms`);return result;}}};window.AionUtils=AionUtils;window.addEventListener('error',(event)=>{AionUtils.errors.log(event.error,'Global error handler');AionUtils.errors.show('An unexpected error occurred. Please refresh the page.');});window.addEventListener('unhandledrejection',(event)=>{AionUtils.errors.log(new Error(event.reason),'Unhandled promise rejection');AionUtils.errors.show('An error occurred while processing your request.');});