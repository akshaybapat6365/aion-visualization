class GitHubPagesRouter{constructor(){this.baseUrl='/aion-visualization';this.routes=new Map();this.currentRoute=null;this.isInitialized=false;this.historySupported=!!(window.history&&history.pushState);this.routePatterns={home:/^\/$/,chapters:/^\/chapters\/$/,chapterEnhanced:/^\/chapters\/enhanced\/(\d+)\/$/,chapterStandard:/^\/chapters\/standard\/(\d+)\/$/,timeline:/^\/timeline\/$/,symbols:/^\/symbols\/$/,about:/^\/about\/$/};this.init();}init(){if(this.isInitialized)return;try{this.setupRoutes();this.handleInitialRoute();this.bindEvents();this.updateNavigationLinks();this.isInitialized=true;}catch(error){console.error('Router initialization failed:',error);this.fallbackToOriginalUrls();}}setupRoutes(){this.routes.set('/','index.html');this.routes.set('/chapters/','chapters/index.html');this.routes.set('/timeline/','src/timeline.html');this.routes.set('/symbols/','src/symbols.html');this.routes.set('/about/','src/about.html');for(let i=1;i<=14;i++){this.routes.set(`/chapters/enhanced/${i}/`,`chapters/enhanced/chapter-${i}.html`);}for(let i=1;i<=14;i++){this.routes.set(`/chapters/standard/${i}/`,`chapters/standard/chapter-${i}.html`);}}handleInitialRoute(){const currentPath=this.getCurrentPath();if(this.isCleanUrl(currentPath)){this.handleRoute(currentPath);return;}const cleanUrl=this.getCleanUrlForCurrentPage();if(cleanUrl&&cleanUrl!==currentPath){this.redirectToCleanUrl(cleanUrl);return;}this.handleLegacyUrl(currentPath);}getCurrentPath(){let path=window.location.pathname;if(path.startsWith(this.baseUrl)){path=path.substring(this.baseUrl.length);}if(!path.startsWith('/')){path='/'+path;}return path;}isCleanUrl(path){return Object.values(this.routePatterns).some(pattern=>pattern.test(path));}getCleanUrlForCurrentPage(){const path=this.getCurrentPath();const cleanUrlMappings={'/index.html':'/','/chapters/index.html':'/chapters/','/src/timeline.html':'/timeline/','/src/symbols.html':'/symbols/','/src/about.html':'/about/'};const chapterMatch=path.match(/\/chapters\/(enhanced|standard)\/chapter-(\d+)\.html$/);if(chapterMatch){const[,type,number]=chapterMatch;return `/chapters/${type}/${number}/`;}return cleanUrlMappings[path]||null;}redirectToCleanUrl(cleanUrl){if(this.historySupported){history.replaceState(null,null,this.baseUrl+cleanUrl);this.handleRoute(cleanUrl);}else{window.location.href=this.baseUrl+cleanUrl;}}handleLegacyUrl(path){const legacyChapterMatch=path.match(/\/chapter(\d+)\.html$/);if(legacyChapterMatch){const chapterNum=legacyChapterMatch[1];const cleanUrl=`/chapters/enhanced/${chapterNum}/`;this.redirectToCleanUrl(cleanUrl);return;}const legacyMappings={'/chapters.html':'/chapters/','/timeline.html':'/timeline/','/symbols.html':'/symbols/','/about.html':'/about/'};const cleanUrl=legacyMappings[path];if(cleanUrl){this.redirectToCleanUrl(cleanUrl);}}handleRoute(path){const actualFile=this.routes.get(path);if(!actualFile){const matchedRoute=this.findMatchingRoute(path);if(matchedRoute){this.loadContent(matchedRoute.file,matchedRoute.params);return;}return;}this.loadContent(actualFile);}findMatchingRoute(path){const enhancedMatch=path.match(this.routePatterns.chapterEnhanced);if(enhancedMatch){const chapterNum=enhancedMatch[1];if(chapterNum>=1&&chapterNum<=14){return{file:`chapters/enhanced/chapter-${chapterNum}.html`,params:{type:'enhanced',chapter:chapterNum}};}}const standardMatch=path.match(this.routePatterns.chapterStandard);if(standardMatch){const chapterNum=standardMatch[1];if(chapterNum>=1&&chapterNum<=14){return{file:`chapters/standard/chapter-${chapterNum}.html`,params:{type:'standard',chapter:chapterNum}};}}return null;}loadContent(filePath,params={}){const fullUrl=this.baseUrl+'/'+filePath;if(this.historySupported){this.fetchAndUpdateContent(fullUrl,params);}else{window.location.href=fullUrl;}}async fetchAndUpdateContent(url,params={}){try{const response=await fetch(url);if(!response.ok){throw new Error(`HTTP ${response.status}:${response.statusText}`);}const html=await response.text();this.updatePageContent(html,params);}catch(error){console.error('Failed to load content:',error);window.location.href=url;}}updatePageContent(html,params={}){const parser=new DOMParser();const doc=parser.parseFromString(html,'text/html');const newTitle=doc.querySelector('title');if(newTitle){document.title=newTitle.textContent;}const newDescription=doc.querySelector('meta[name="description"]');const existingDescription=document.querySelector('meta[name="description"]');if(newDescription&&existingDescription){existingDescription.setAttribute('content',newDescription.getAttribute('content'));}const newMain=doc.querySelector('main')||doc.querySelector('body');const existingMain=document.querySelector('main')||document.querySelector('body');if(newMain&&existingMain){const nav=existingMain.querySelector('nav');existingMain.innerHTML=newMain.innerHTML;if(nav){existingMain.prepend(nav);}}this.executeScripts(doc);this.updateNavigationActiveState();this.dispatchRouteChangeEvent(params);}executeScripts(doc){const scripts=doc.querySelectorAll('script');scripts.forEach(script=>{if(script.src){const newScript=document.createElement('script');newScript.src=script.src;newScript.async=true;document.head.appendChild(newScript);}else if(script.textContent){try{eval(script.textContent);}catch(error){}}});}bindEvents(){window.addEventListener('popstate',(event)=>{const path=this.getCurrentPath();this.handleRoute(path);});document.addEventListener('click',(event)=>{const link=event.target.closest('a[href]');if(!link)return;const href=link.getAttribute('href');if(this.shouldInterceptLink(href)){event.preventDefault();this.navigateTo(href);}});document.addEventListener('submit',(event)=>{const form=event.target;if(form.hasAttribute('data-clean-url')){event.preventDefault();this.handleFormSubmission(form);}});}shouldInterceptLink(href){if(!href||href.startsWith('#')||href.startsWith('mailto:')||href.startsWith('tel:')){return false;}if(href.startsWith('http')&&!href.includes('github.io/aion-visualization')){return false;}return true;}navigateTo(path){const cleanPath=this.getCleanUrlForPath(path);const fullPath=cleanPath||path;if(this.historySupported){history.pushState(null,null,this.baseUrl+fullPath);this.handleRoute(fullPath);}else{window.location.href=this.baseUrl+fullPath;}}getCleanUrlForPath(path){if(path.startsWith(this.baseUrl)){path=path.substring(this.baseUrl.length);}const cleanMappings={'/index.html':'/','/chapters/index.html':'/chapters/','/src/timeline.html':'/timeline/','/src/symbols.html':'/symbols/','/src/about.html':'/about/'};const chapterMatch=path.match(/\/chapters\/(enhanced|standard)\/chapter-(\d+)\.html$/);if(chapterMatch){const[,type,number]=chapterMatch;return `/chapters/${type}/${number}/`;}return cleanMappings[path]||path;}updateNavigationLinks(){const navLinks=document.querySelectorAll('nav a[href]');navLinks.forEach(link=>{const href=link.getAttribute('href');const cleanUrl=this.getCleanUrlForPath(href);if(cleanUrl&&cleanUrl!==href){link.setAttribute('href',cleanUrl);link.setAttribute('data-original-href',href);}});}updateNavigationActiveState(){const currentPath=this.getCurrentPath();const navLinks=document.querySelectorAll('nav a[href]');navLinks.forEach(link=>{const href=link.getAttribute('href');const isActive=href===currentPath||(href!=='/'&&currentPath.startsWith(href));link.classList.toggle('active',isActive);});}handleFormSubmission(form){const formData=new FormData(form);const action=form.getAttribute('action')||'';const method=form.getAttribute('method')||'GET';if(method.toLowerCase()==='get'){const params=new URLSearchParams(formData);const cleanUrl=this.getCleanUrlForPath(action);const fullUrl=`${cleanUrl}?${params.toString()}`;this.navigateTo(fullUrl);}}dispatchRouteChangeEvent(params={}){const event=new CustomEvent('routechange',{detail:{path:this.getCurrentPath(),params:params,timestamp:Date.now()}});window.dispatchEvent(event);}fallbackToOriginalUrls(){const links=document.querySelectorAll('a[data-original-href]');links.forEach(link=>{const originalHref=link.getAttribute('data-original-href');link.setAttribute('href',originalHref);link.removeAttribute('data-original-href');});}getCurrentRoute(){return this.getCurrentPath();}isRouteActive(path){const currentPath=this.getCurrentPath();return currentPath===path||(path!=='/'&&currentPath.startsWith(path));}getRouteParams(){const path=this.getCurrentPath();const matchedRoute=this.findMatchingRoute(path);return matchedRoute?matchedRoute.params:{};}static generateCleanUrl(type,params={}){switch(type){case 'chapter':const chapterType=params.type||'enhanced';const chapterNum=params.chapter||1;return `/chapters/${chapterType}/${chapterNum}/`;case 'chapters':return '/chapters/';case 'timeline':return '/timeline/';case 'symbols':return '/symbols/';case 'about':return '/about/';default:return '/';}}}document.addEventListener('DOMContentLoaded',()=>{window.githubPagesRouter=new GitHubPagesRouter();});window.GitHubPagesRouter=GitHubPagesRouter;if(typeof module!=='undefined'&&module.exports){module.exports=GitHubPagesRouter;}