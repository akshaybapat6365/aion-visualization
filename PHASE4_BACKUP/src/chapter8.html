<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 8: Natural Transformation Symbols - Aion by Carl Jung</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="responsive-utils.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="webgl-utils.js"></script>
    <script src="error-boundaries.js"></script>
    <script src="accessibility-utils.js"></script>
    <script src="progress-tracker.js"></script>
    <script src="visualization-loader.js"></script>
    <script src="apply-fixes.js" defer></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <a href="./index.html" class="nav-link">Home</a>
            <a href="chapters/index.html" class="nav-link">Chapters</a>
            <a href="src/timeline.html" class="nav-link">Timeline</a>
            <a href="src/symbols.html" class="nav-link">Symbols</a>
            <a href="src/about.html" class="nav-link">About</a>
        </div>
    </nav>

    <main class="chapter-content">
        <div class="chapter-header">
            <div class="chapter-number">Chapter VIII</div>
            <h1 class="chapter-title">Natural Transformation Symbols</h1>
            <p class="chapter-subtitle">Interactive Alchemical Transformation Laboratory</p>
        </div>

        <section class="chapter-intro">
            <p>Jung saw alchemical symbols as projections of the individuation process. The transformation of base metals into gold represents the psychological transformation of the unconscious into consciousness, the journey from prima materia to the philosopher's stone of the Self.</p>
        </section>

        <!-- Interactive Alchemical Laboratory -->
        <section class="visualization-section">
            <h2>Advanced Alchemical Laboratory</h2>
            <div class="visualization-intro">
                <p>Experience the Great Work through interactive alchemical processes. Each transformation stage represents psychological development and individuation progress.</p>
            </div>
            <div id="alchemical-lab" class="visualization-container">
                <!-- Laboratory Interface -->
                <div class="lab-interface">
                    <!-- Element Periodic Table -->
                    <div class="element-table">
                        <h3>Alchemical Elements</h3>
                        <div class="elements-grid">
                            <div class="element-card" data-element="mercury" draggable="true">
                                <div class="element-symbol">‚òø</div>
                                <div class="element-name">Mercury</div>
                                <div class="element-meaning">Spirit/Quicksilver</div>
                            </div>
                            <div class="element-card" data-element="sulfur" draggable="true">
                                <div class="element-symbol">üúç</div>
                                <div class="element-name">Sulfur</div>
                                <div class="element-meaning">Soul/Fire</div>
                            </div>
                            <div class="element-card" data-element="salt" draggable="true">
                                <div class="element-symbol">üúî</div>
                                <div class="element-name">Salt</div>
                                <div class="element-meaning">Body/Earth</div>
                            </div>
                            <div class="element-card" data-element="lead" draggable="true">
                                <div class="element-symbol">‚ôÑ</div>
                                <div class="element-name">Lead</div>
                                <div class="element-meaning">Prima Materia</div>
                            </div>
                            <div class="element-card" data-element="iron" draggable="true">
                                <div class="element-symbol">‚ôÇ</div>
                                <div class="element-name">Iron</div>
                                <div class="element-meaning">Mars/Masculine</div>
                            </div>
                            <div class="element-card" data-element="copper" draggable="true">
                                <div class="element-symbol">‚ôÄ</div>
                                <div class="element-name">Copper</div>
                                <div class="element-meaning">Venus/Feminine</div>
                            </div>
                            <div class="element-card" data-element="silver" draggable="true">
                                <div class="element-symbol">‚òΩ</div>
                                <div class="element-name">Silver</div>
                                <div class="element-meaning">Moon/Feminine</div>
                            </div>
                            <div class="element-card" data-element="gold" draggable="true">
                                <div class="element-symbol">‚òâ</div>
                                <div class="element-name">Gold</div>
                                <div class="element-meaning">Sun/Perfection</div>
                            </div>
                        </div>
                    </div>

                    <!-- Transformation Vessel -->
                    <div class="transformation-vessel">
                        <h3>Hermetic Vessel</h3>
                        <div class="vessel-container" id="vessel-drop-zone">
                            <div class="vessel-contents" id="vessel-contents"></div>
                            <div class="vessel-stage" id="vessel-stage">Prima Materia</div>
                            <div class="vessel-heat-indicator" id="heat-indicator"></div>
                        </div>
                        
                        <!-- Heat Control -->
                        <div class="heat-controls">
                            <label for="furnace-heat">üî• Furnace Heat:</label>
                            <input type="range" id="furnace-heat" min="0" max="100" value="0">
                            <span id="heat-level">Cold</span>
                        </div>

                        <!-- Alchemical Operations -->
                        <div class="operations-panel">
                            <h4>Alchemical Operations</h4>
                            <div class="operations-grid">
                                <button class="operation-btn" data-operation="calcination">Calcination</button>
                                <button class="operation-btn" data-operation="dissolution">Dissolution</button>
                                <button class="operation-btn" data-operation="separation">Separation</button>
                                <button class="operation-btn" data-operation="conjunction">Conjunction</button>
                                <button class="operation-btn" data-operation="fermentation">Fermentation</button>
                                <button class="operation-btn" data-operation="distillation">Distillation</button>
                                <button class="operation-btn" data-operation="coagulation">Coagulation</button>
                            </div>
                        </div>
                    </div>

                    <!-- Transformation Progress -->
                    <div class="progress-panel">
                        <h3>Transformation Progress</h3>
                        <div class="stage-wheel" id="stage-wheel">
                            <div class="stage-indicator" data-stage="nigredo">
                                <div class="stage-symbol">‚óè</div>
                                <div class="stage-name">Nigredo</div>
                                <div class="stage-description">Blackening/Decomposition</div>
                            </div>
                            <div class="stage-indicator" data-stage="albedo">
                                <div class="stage-symbol">‚óã</div>
                                <div class="stage-name">Albedo</div>
                                <div class="stage-description">Whitening/Purification</div>
                            </div>
                            <div class="stage-indicator" data-stage="citrinitas">
                                <div class="stage-symbol">‚òΩ</div>
                                <div class="stage-name">Citrinitas</div>
                                <div class="stage-description">Yellowing/Solar</div>
                            </div>
                            <div class="stage-indicator" data-stage="rubedo">
                                <div class="stage-symbol">‚òâ</div>
                                <div class="stage-name">Rubedo</div>
                                <div class="stage-description">Reddening/Completion</div>
                            </div>
                        </div>

                        <!-- Achievement System -->
                        <div class="achievements">
                            <h4>Alchemical Achievements</h4>
                            <div id="achievements-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Laboratory Log -->
                <div class="lab-log">
                    <h3>Laboratory Journal</h3>
                    <div id="log-entries"></div>
                </div>
            </div>

            <div class="lab-controls">
                <button id="reset-lab">Reset Laboratory</button>
                <button id="save-experiment">Save Experiment</button>
                <button id="load-recipe">Load Classic Recipe</button>
                <button id="analyze-composition">Analyze Composition</button>
            </div>
        </section>

        <!-- Symbol Evolution Timeline -->
        <section class="visualization-section">
            <h2>Evolution of Alchemical Symbols</h2>
            <div class="visualization-intro">
                <p>Trace how alchemical symbols evolved across cultures and centuries, from Egyptian metallurgy to medieval Europe to modern psychology.</p>
            </div>
            <div id="symbol-evolution" class="visualization-container"></div>
            <div class="evolution-controls">
                <button id="show-egyptian">Egyptian Origins</button>
                <button id="show-arabic">Arabic Development</button>
                <button id="show-medieval">Medieval Europe</button>
                <button id="show-renaissance">Renaissance</button>
                <button id="show-jungian">Jungian Psychology</button>
            </div>
        </section>

        <!-- Planetary Correspondences -->
        <section class="visualization-section">
            <h2>Planetary-Metal Correspondences</h2>
            <div class="visualization-intro">
                <p>Explore the seven classical metals and their planetary correspondences, understanding how celestial movements were believed to influence terrestrial transformations.</p>
            </div>
            <div id="planetary-correspondences" class="visualization-container">
                <div class="correspondence-wheel">
                    <div class="planet-metal-pair" data-planet="sun">
                        <div class="planet">‚òâ Sun</div>
                        <div class="connection-line"></div>
                        <div class="metal">Gold ‚ôî</div>
                        <div class="qualities">Perfection, Consciousness</div>
                    </div>
                    <div class="planet-metal-pair" data-planet="moon">
                        <div class="planet">‚òΩ Moon</div>
                        <div class="connection-line"></div>
                        <div class="metal">Silver ‚ôï</div>
                        <div class="qualities">Intuition, Unconscious</div>
                    </div>
                    <div class="planet-metal-pair" data-planet="mercury">
                        <div class="planet">‚òø Mercury</div>
                        <div class="connection-line"></div>
                        <div class="metal">Quicksilver ‚ö≠</div>
                        <div class="qualities">Transformation, Mediation</div>
                    </div>
                    <div class="planet-metal-pair" data-planet="venus">
                        <div class="planet">‚ôÄ Venus</div>
                        <div class="connection-line"></div>
                        <div class="metal">Copper ‚ôÄ</div>
                        <div class="qualities">Love, Harmony</div>
                    </div>
                    <div class="planet-metal-pair" data-planet="mars">
                        <div class="planet">‚ôÇ Mars</div>
                        <div class="connection-line"></div>
                        <div class="metal">Iron ‚ôÇ</div>
                        <div class="qualities">Strength, Aggression</div>
                    </div>
                    <div class="planet-metal-pair" data-planet="jupiter">
                        <div class="planet">‚ôÉ Jupiter</div>
                        <div class="connection-line"></div>
                        <div class="metal">Tin ‚ôÉ</div>
                        <div class="qualities">Expansion, Wisdom</div>
                    </div>
                    <div class="planet-metal-pair" data-planet="saturn">
                        <div class="planet">‚ôÑ Saturn</div>
                        <div class="connection-line"></div>
                        <div class="metal">Lead ‚ôÑ</div>
                        <div class="qualities">Limitation, Time</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Educational Content -->
        <section class="content-section">
            <h2>Alchemical Transformation as Individuation</h2>
            <div class="concept-grid">
                <div class="concept-card">
                    <h3>Prima Materia</h3>
                    <p>The "first matter" represents the unconscious state at the beginning of psychological development - chaotic, undifferentiated, but containing all potential.</p>
                    <ul>
                        <li>Unconscious totality</li>
                        <li>Undifferentiated psyche</li>
                        <li>Raw psychological material</li>
                        <li>Potential for transformation</li>
                    </ul>
                </div>
                
                <div class="concept-card">
                    <h3>The Four Stages</h3>
                    <p>The classical alchemical stages mirror the psychological individuation process, each representing a crucial phase of development.</p>
                    <ul>
                        <li><strong>Nigredo:</strong> Depression, dissolution of ego</li>
                        <li><strong>Albedo:</strong> Purification, ego-Self separation</li>
                        <li><strong>Citrinitas:</strong> Illumination, conscious realization</li>
                        <li><strong>Rubedo:</strong> Integration, wholeness achieved</li>
                    </ul>
                </div>
                
                <div class="concept-card">
                    <h3>Mercurius</h3>
                    <p>The alchemical Mercury represents the transformative principle - the psychic function that mediates between opposites and enables change.</p>
                    <ul>
                        <li>Mediator between conscious/unconscious</li>
                        <li>Spirit of transformation</li>
                        <li>Trickster and guide</li>
                        <li>Bridge between above and below</li>
                    </ul>
                </div>
                
                <div class="concept-card">
                    <h3>The Philosopher's Stone</h3>
                    <p>The goal of the Great Work - the achievement of psychological wholeness through the integration of all aspects of the personality.</p>
                    <ul>
                        <li>Symbol of the realized Self</li>
                        <li>Union of opposites</li>
                        <li>Psychological gold</li>
                        <li>Completed individuation</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Jung Quotes -->
        <section class="content-section">
            <h2>Jung on Alchemy and Transformation</h2>
            <div class="quotes-container">
                <blockquote class="jung-quote">
                    <p>"The alchemical operations were real, only this reality was not physical but psychological."</p>
                    <cite>‚Äî Carl Jung, Psychology and Alchemy</cite>
                </blockquote>
                
                <blockquote class="jung-quote">
                    <p>"The prima materia is the 'massa confusa' at the beginning of the work, the chaos or nigredo, and it is also the goal of the work."</p>
                    <cite>‚Äî Carl Jung, Mysterium Coniunctionis</cite>
                </blockquote>
                
                <blockquote class="jung-quote">
                    <p>"In alchemy the egg stands for the chaos apprehended by the artifex, the prima materia containing the captive world-soul."</p>
                    <cite>‚Äî Carl Jung, Psychology and Alchemy</cite>
                </blockquote>
                
                <blockquote class="jung-quote">
                    <p>"The alchemists' endeavours to unite the opposites culminate in the symbol of the coniunctio, the chemical wedding."</p>
                    <cite>‚Äî Carl Jung, Mysterium Coniunctionis</cite>
                </blockquote>
            </div>
        </section>
    </main>

    <style>
        .lab-interface {
            display: grid;
            grid-template-columns: 300px 1fr 250px;
            gap: 2rem;
            padding: 2rem;
            background: var(--surface-glass);
            border-radius: 1rem;
            min-height: 600px;
        }

        .element-table {
            background: var(--surface-secondary);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-default);
        }

        .element-table h3 {
            color: var(--accent);
            margin-bottom: 1rem;
            text-align: center;
        }

        .elements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .element-card {
            padding: 0.75rem;
            background: var(--surface-glass);
            border: 1px solid var(--border-subtle);
            border-radius: 0.25rem;
            cursor: move;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.75rem;
        }

        .element-card:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.05);
        }

        .element-card[draggable="true"] {
            user-select: none;
        }

        .element-symbol {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .element-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .element-meaning {
            font-size: 0.625rem;
            color: var(--text-tertiary);
        }

        .transformation-vessel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .transformation-vessel h3 {
            color: var(--accent);
            margin-bottom: 0;
        }

        .vessel-container {
            width: 200px;
            height: 300px;
            background: linear-gradient(to bottom, transparent 0%, var(--surface-secondary) 20%, var(--surface-primary) 100%);
            border: 3px solid var(--border-default);
            border-radius: 0 0 50% 50%;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .vessel-container.dragover {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(107, 70, 193, 0.3);
        }

        .vessel-contents {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 0%;
            background: linear-gradient(to top, var(--accent), transparent);
            transition: all 0.5s ease;
            border-radius: 0 0 50% 50%;
        }

        .vessel-stage {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-secondary);
            background: rgba(0, 0, 0, 0.7);
            padding: 0.25rem;
            border-radius: 0.25rem;
        }

        .vessel-heat-indicator {
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 20px;
            background: linear-gradient(to right, transparent, #ff4444, transparent);
            border-radius: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .heat-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--surface-secondary);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-default);
        }

        .heat-controls label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .heat-controls input[type="range"] {
            flex: 1;
        }

        .heat-controls span {
            min-width: 50px;
            text-align: center;
            font-size: 0.875rem;
            color: var(--accent);
        }

        .operations-panel {
            background: var(--surface-secondary);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-default);
            width: 100%;
        }

        .operations-panel h4 {
            color: var(--accent);
            margin-bottom: 0.75rem;
            text-align: center;
        }

        .operations-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
        }

        .operation-btn {
            padding: 0.5rem;
            background: var(--surface-glass);
            border: 1px solid var(--border-subtle);
            border-radius: 0.25rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.75rem;
        }

        .operation-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .operation-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-panel {
            background: var(--surface-secondary);
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-default);
        }

        .progress-panel h3 {
            color: var(--accent);
            margin-bottom: 1rem;
            text-align: center;
        }

        .stage-wheel {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .stage-indicator {
            padding: 0.75rem;
            background: var(--surface-glass);
            border: 1px solid var(--border-subtle);
            border-radius: 0.25rem;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 0.75rem;
        }

        .stage-indicator.active {
            border-color: var(--accent);
            background: rgba(107, 70, 193, 0.1);
        }

        .stage-symbol {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        .stage-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .stage-description {
            font-size: 0.625rem;
            color: var(--text-tertiary);
        }

        .achievements {
            margin-top: 1rem;
        }

        .achievements h4 {
            color: var(--accent);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .achievement {
            padding: 0.25rem 0.5rem;
            background: var(--surface-glass);
            border-radius: 0.25rem;
            margin-bottom: 0.25rem;
            font-size: 0.75rem;
            border-left: 3px solid var(--accent);
        }

        .lab-log {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--surface-secondary);
            border-radius: 0.5rem;
            border: 1px solid var(--border-default);
            max-height: 200px;
            overflow-y: auto;
        }

        .lab-log h3 {
            color: var(--accent);
            margin-bottom: 0.75rem;
        }

        .log-entry {
            padding: 0.5rem;
            background: var(--surface-glass);
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            border-left: 3px solid var(--border-default);
        }

        .log-entry.important {
            border-left-color: var(--accent);
        }

        .lab-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .lab-controls button {
            padding: 0.75rem 1.5rem;
            background: var(--surface-glass);
            color: var(--text-primary);
            border: 1px solid var(--border-default);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lab-controls button:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .evolution-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .evolution-controls button {
            padding: 0.5rem 1rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .evolution-controls button:hover {
            background: var(--accent-dark);
            transform: translateY(-1px);
        }

        .correspondence-wheel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            padding: 2rem;
        }

        .planet-metal-pair {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: var(--surface-glass);
            border-radius: 0.5rem;
            border: 1px solid var(--border-subtle);
            transition: all 0.3s ease;
        }

        .planet-metal-pair:hover {
            border-color: var(--accent);
            background: rgba(107, 70, 193, 0.05);
        }

        .planet, .metal {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .connection-line {
            width: 2px;
            height: 20px;
            background: var(--accent);
            border-radius: 1px;
        }

        .qualities {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
        }

        @media (max-width: 768px) {
            .lab-interface {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }

            .elements-grid {
                grid-template-columns: repeat(3, 1fr);
            }

            .operations-grid {
                grid-template-columns: 1fr;
            }

            .stage-wheel {
                grid-template-columns: 1fr;
            }

            .correspondence-wheel {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
        }
    </style>

    <script>
        // Enhanced Chapter 8: Alchemical Laboratory Implementation
        document.addEventListener('DOMContentLoaded', () => {
            initializeAlchemicalLab();
            initializeSymbolEvolution();
            initializePlanetaryCorrespondences();
        });

        function initializeAlchemicalLab() {
            // Laboratory state
            let labState = {
                elements: [],
                heat: 0,
                stage: 'prima-materia',
                operations: [],
                achievements: []
            };

            const vesselDropZone = document.getElementById('vessel-drop-zone');
            const vesselContents = document.getElementById('vessel-contents');
            const vesselStage = document.getElementById('vessel-stage');
            const heatIndicator = document.getElementById('heat-indicator');
            const logEntries = document.getElementById('log-entries');
            const achievementsList = document.getElementById('achievements-list');

            // Drag and drop functionality
            document.querySelectorAll('.element-card').forEach(card => {
                card.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.dataset.element);
                });
            });

            vesselDropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                vesselDropZone.classList.add('dragover');
            });

            vesselDropZone.addEventListener('dragleave', () => {
                vesselDropZone.classList.remove('dragover');
            });

            vesselDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                vesselDropZone.classList.remove('dragover');
                
                const element = e.dataTransfer.getData('text/plain');
                addElementToVessel(element);
            });

            function addElementToVessel(element) {
                labState.elements.push(element);
                updateVesselContents();
                logEntry(`Added ${element} to vessel`);
                checkForReactions();
            }

            function updateVesselContents() {
                const fillLevel = Math.min(labState.elements.length * 20, 80);
                vesselContents.style.height = `${fillLevel}%`;
                
                // Color based on elements
                const colors = {
                    mercury: '#C0C0C0',
                    sulfur: '#FFD700',
                    salt: '#FFFFFF',
                    lead: '#2F4F4F',
                    iron: '#B22222',
                    copper: '#B87333',
                    silver: '#C0C0C0',
                    gold: '#FFD700'
                };
                
                if (labState.elements.length > 0) {
                    const lastElement = labState.elements[labState.elements.length - 1];
                    vesselContents.style.background = colors[lastElement] || '#666';
                }
            }

            // Heat control
            document.getElementById('furnace-heat').addEventListener('input', (e) => {
                labState.heat = parseInt(e.target.value);
                updateHeatLevel();
                checkForReactions();
            });

            function updateHeatLevel() {
                const heatLevel = document.getElementById('heat-level');
                const levels = ['Cold', 'Warm', 'Hot', 'Very Hot', 'Blazing'];
                const levelIndex = Math.floor(labState.heat / 20);
                heatLevel.textContent = levels[levelIndex] || 'Blazing';
                
                heatIndicator.style.opacity = labState.heat / 100;
            }

            // Alchemical operations
            document.querySelectorAll('.operation-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const operation = e.target.dataset.operation;
                    performOperation(operation);
                });
            });

            function performOperation(operation) {
                labState.operations.push(operation);
                logEntry(`Performed ${operation}`, true);
                
                const operationEffects = {
                    calcination: () => {
                        if (labState.heat > 80 && labState.elements.includes('lead')) {
                            changeStage('nigredo');
                            logEntry('Calcination complete - entered Nigredo phase', true);
                            addAchievement('First Decomposition');
                        } else {
                            logEntry('Calcination requires high heat and prima materia');
                        }
                    },
                    dissolution: () => {
                        if (labState.stage === 'nigredo' && labState.elements.includes('mercury')) {
                            logEntry('Dissolution successful - matter becomes fluid');
                            addAchievement('Mercurial Dissolution');
                        } else {
                            logEntry('Dissolution requires nigredo stage and mercury');
                        }
                    },
                    separation: () => {
                        if (labState.operations.includes('dissolution')) {
                            logEntry('Separation of pure from impure');
                            addAchievement('Divine Separation');
                        }
                    },
                    conjunction: () => {
                        if (labState.elements.includes('sulfur') && labState.elements.includes('mercury')) {
                            logEntry('Conjunction of opposites - sulfur and mercury unite');
                            addAchievement('Chemical Wedding');
                        }
                    },
                    fermentation: () => {
                        if (labState.stage === 'nigredo' && labState.heat > 40) {
                            changeStage('albedo');
                            logEntry('Fermentation complete - achieved Albedo', true);
                            addAchievement('White Queen');
                        }
                    },
                    distillation: () => {
                        if (labState.stage === 'albedo' && labState.heat > 60) {
                            changeStage('citrinitas');
                            logEntry('Distillation successful - achieved Citrinitas', true);
                            addAchievement('Solar Illumination');
                        }
                    },
                    coagulation: () => {
                        if (labState.stage === 'citrinitas' && labState.elements.includes('gold')) {
                            changeStage('rubedo');
                            logEntry('Coagulation complete - the Philosopher\'s Stone is born!', true);
                            addAchievement('Magnum Opus Complete');
                            addAchievement('Philosopher\'s Stone');
                        }
                    }
                };

                if (operationEffects[operation]) {
                    operationEffects[operation]();
                } else {
                    logEntry(`${operation} attempted`);
                }
            }

            function changeStage(newStage) {
                labState.stage = newStage;
                vesselStage.textContent = newStage.charAt(0).toUpperCase() + newStage.slice(1);
                
                // Update stage indicators
                document.querySelectorAll('.stage-indicator').forEach(indicator => {
                    indicator.classList.remove('active');
                });
                document.querySelector(`[data-stage="${newStage}"]`).classList.add('active');
                
                // Update vessel appearance based on stage
                const stageColors = {
                    'prima-materia': 'var(--surface-glass)',
                    'nigredo': '#2F2F2F',
                    'albedo': '#F5F5F5',
                    'citrinitas': '#FFD700',
                    'rubedo': '#DC143C'
                };
                
                vesselContents.style.background = stageColors[newStage] || 'var(--accent)';
            }

            function checkForReactions() {
                const { elements, heat } = labState;
                
                // Check for basic prima materia
                if (elements.includes('lead') && elements.includes('mercury') && heat > 20) {
                    if (labState.stage === 'prima-materia') {
                        setTimeout(() => {
                            logEntry('Prima materia activated - ready for transformation', true);
                        }, 1000);
                    }
                }
                
                // Check for spontaneous reactions
                if (elements.includes('sulfur') && elements.includes('salt') && elements.includes('mercury')) {
                    if (!labState.achievements.includes('Triple Unity')) {
                        logEntry('Triple unity achieved - sulfur, salt, and mercury combined', true);
                        addAchievement('Triple Unity');
                    }
                }
            }

            function logEntry(message, important = false) {
                const entry = document.createElement('div');
                entry.className = `log-entry ${important ? 'important' : ''}`;
                entry.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
                logEntries.insertBefore(entry, logEntries.firstChild);
                
                // Limit log entries
                if (logEntries.children.length > 20) {
                    logEntries.removeChild(logEntries.lastChild);
                }
            }

            function addAchievement(achievement) {
                if (!labState.achievements.includes(achievement)) {
                    labState.achievements.push(achievement);
                    const achievementEl = document.createElement('div');
                    achievementEl.className = 'achievement';
                    achievementEl.textContent = `üèÜ ${achievement}`;
                    achievementsList.appendChild(achievementEl);
                }
            }

            // Control handlers
            document.getElementById('reset-lab').addEventListener('click', () => {
                labState = {
                    elements: [],
                    heat: 0,
                    stage: 'prima-materia',
                    operations: [],
                    achievements: []
                };
                
                vesselContents.style.height = '0%';
                vesselContents.style.background = 'var(--accent)';
                vesselStage.textContent = 'Prima Materia';
                document.getElementById('furnace-heat').value = 0;
                updateHeatLevel();
                logEntries.innerHTML = '';
                achievementsList.innerHTML = '';
                
                document.querySelectorAll('.stage-indicator').forEach(indicator => {
                    indicator.classList.remove('active');
                });
                
                logEntry('Laboratory reset - ready for new experiment');
            });

            document.getElementById('load-recipe').addEventListener('click', () => {
                // Load classic recipe for philosopher's stone
                document.getElementById('reset-lab').click();
                
                setTimeout(() => {
                    addElementToVessel('lead');
                    setTimeout(() => addElementToVessel('mercury'), 500);
                    setTimeout(() => addElementToVessel('sulfur'), 1000);
                    setTimeout(() => {
                        document.getElementById('furnace-heat').value = 50;
                        updateHeatLevel();
                    }, 1500);
                }, 100);
            });

            // Initialize
            logEntry('Laboratory initialized - ready for alchemical work');
        }

        function initializeSymbolEvolution() {
            const container = document.getElementById('symbol-evolution');
            if (!container) return;

            const width = container.offsetWidth;
            const height = 400;

            const svg = d3.select(container)
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            // Evolution data
            const evolutionData = {
                egyptian: [
                    { symbol: '‚òâ', name: 'Gold', period: '3000 BCE', meaning: 'Solar divinity' },
                    { symbol: '‚òΩ', name: 'Silver', period: '3000 BCE', meaning: 'Lunar goddess' },
                    { symbol: '‚ôÄ', name: 'Copper', period: '2500 BCE', meaning: 'Hathor metal' }
                ],
                arabic: [
                    { symbol: '‚òø', name: 'Mercury', period: '800 CE', meaning: 'Quick-silver spirit' },
                    { symbol: 'üúç', name: 'Sulfur', period: '800 CE', meaning: 'Combustible principle' },
                    { symbol: 'üúî', name: 'Salt', period: '800 CE', meaning: 'Fixed principle' }
                ],
                medieval: [
                    { symbol: '‚ôÇ', name: 'Iron', period: '1200 CE', meaning: 'Mars warrior' },
                    { symbol: '‚ôÉ', name: 'Tin', period: '1200 CE', meaning: 'Jupiter expansion' },
                    { symbol: '‚ôÑ', name: 'Lead', period: '1200 CE', meaning: 'Saturn time' }
                ],
                renaissance: [
                    { symbol: 'üú®', name: 'Antimony', period: '1500 CE', meaning: 'Gray wolf' },
                    { symbol: 'üú©', name: 'Bismuth', period: '1500 CE', meaning: 'White metal' },
                    { symbol: 'üú™', name: 'Zinc', period: '1600 CE', meaning: 'Spelter' }
                ],
                jungian: [
                    { symbol: '‚ö≠', name: 'Union', period: '1944 CE', meaning: 'Coniunctio oppositorum' },
                    { symbol: '‚óâ', name: 'Self', period: '1944 CE', meaning: 'Totality symbol' },
                    { symbol: '‚óé', name: 'Mandala', period: '1950 CE', meaning: 'Wholeness pattern' }
                ]
            };

            function showEvolution(period) {
                svg.selectAll('*').remove();
                
                const data = evolutionData[period] || [];
                const symbolRadius = 30;
                const centerX = width / 2;
                const centerY = height / 2;
                
                // Create circular arrangement
                data.forEach((item, index) => {
                    const angle = (index * 2 * Math.PI) / data.length - Math.PI / 2;
                    const radius = Math.min(width, height) / 3;
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    // Symbol circle
                    svg.append('circle')
                        .attr('cx', x)
                        .attr('cy', y)
                        .attr('r', symbolRadius)
                        .attr('fill', 'var(--accent)')
                        .attr('stroke', '#fff')
                        .attr('stroke-width', 2)
                        .attr('opacity', 0)
                        .transition()
                        .duration(500)
                        .delay(index * 100)
                        .attr('opacity', 0.8);
                    
                    // Symbol text
                    svg.append('text')
                        .attr('x', x)
                        .attr('y', y + 5)
                        .attr('text-anchor', 'middle')
                        .attr('font-size', '20px')
                        .attr('fill', 'white')
                        .text(item.symbol)
                        .attr('opacity', 0)
                        .transition()
                        .duration(500)
                        .delay(index * 100)
                        .attr('opacity', 1);
                    
                    // Name text
                    svg.append('text')
                        .attr('x', x)
                        .attr('y', y + symbolRadius + 20)
                        .attr('text-anchor', 'middle')
                        .attr('font-size', '12px')
                        .attr('fill', 'var(--text-primary)')
                        .text(item.name)
                        .attr('opacity', 0)
                        .transition()
                        .duration(500)
                        .delay(index * 100 + 200)
                        .attr('opacity', 1);
                    
                    // Period text
                    svg.append('text')
                        .attr('x', x)
                        .attr('y', y + symbolRadius + 35)
                        .attr('text-anchor', 'middle')
                        .attr('font-size', '10px')
                        .attr('fill', 'var(--text-secondary)')
                        .text(item.period)
                        .attr('opacity', 0)
                        .transition()
                        .duration(500)
                        .delay(index * 100 + 300)
                        .attr('opacity', 1);
                });
                
                // Period title
                svg.append('text')
                    .attr('x', centerX)
                    .attr('y', 30)
                    .attr('text-anchor', 'middle')
                    .attr('font-size', '18px')
                    .attr('font-weight', 'bold')
                    .attr('fill', 'var(--accent)')
                    .text(period.charAt(0).toUpperCase() + period.slice(1) + ' Period');
            }

            // Control handlers
            document.getElementById('show-egyptian').addEventListener('click', () => showEvolution('egyptian'));
            document.getElementById('show-arabic').addEventListener('click', () => showEvolution('arabic'));
            document.getElementById('show-medieval').addEventListener('click', () => showEvolution('medieval'));
            document.getElementById('show-renaissance').addEventListener('click', () => showEvolution('renaissance'));
            document.getElementById('show-jungian').addEventListener('click', () => showEvolution('jungian'));

            // Initialize with medieval
            showEvolution('medieval');
        }

        function initializePlanetaryCorrespondences() {
            // Add interactive behavior to correspondences
            document.querySelectorAll('.planet-metal-pair').forEach(pair => {
                pair.addEventListener('click', () => {
                    // Remove previous active states
                    document.querySelectorAll('.planet-metal-pair').forEach(p => {
                        p.style.transform = 'scale(1)';
                        p.style.borderColor = 'var(--border-subtle)';
                    });
                    
                    // Activate clicked pair
                    pair.style.transform = 'scale(1.05)';
                    pair.style.borderColor = 'var(--accent)';
                    
                    // Show detailed information
                    const planet = pair.dataset.planet;
                    showPlanetaryDetails(planet);
                });
            });
        }

        function showPlanetaryDetails(planet) {
            const details = {
                sun: 'The Sun represents consciousness, the ego, and the drive toward individuation. In alchemy, gold symbolizes the perfected Self.',
                moon: 'The Moon represents the unconscious, intuition, and the feminine principle. Silver embodies receptivity and reflection.',
                mercury: 'Mercury mediates between opposites, representing the transformative spirit that enables psychological change.',
                venus: 'Venus embodies love, harmony, and the anima. Copper represents the capacity for relationship and aesthetic appreciation.',
                mars: 'Mars represents drive, aggression, and the masculine principle. Iron symbolizes willpower and directed energy.',
                jupiter: 'Jupiter represents expansion, wisdom, and spiritual growth. Tin embodies the capacity for growth and learning.',
                saturn: 'Saturn represents limitation, structure, and time. Lead symbolizes the heavy, depressive aspects that must be transformed.'
            };
            
            // Create or update details panel
            let detailsPanel = document.getElementById('planetary-details');
            if (!detailsPanel) {
                detailsPanel = document.createElement('div');
                detailsPanel.id = 'planetary-details';
                detailsPanel.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: var(--surface-secondary);
                    border: 1px solid var(--border-default);
                    border-radius: 0.5rem;
                    padding: 1.5rem;
                    max-width: 400px;
                    z-index: 1000;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                `;
                document.body.appendChild(detailsPanel);
            }
            
            detailsPanel.innerHTML = `
                <h3 style="color: var(--accent); margin-bottom: 1rem;">${planet.charAt(0).toUpperCase() + planet.slice(1)} Correspondence</h3>
                <p style="color: var(--text-primary); line-height: 1.6;">${details[planet]}</p>
                <button onclick="this.parentElement.style.display='none'" style="
                    margin-top: 1rem;
                    padding: 0.5rem 1rem;
                    background: var(--accent);
                    color: white;
                    border: none;
                    border-radius: 0.25rem;
                    cursor: pointer;
                ">Close</button>
            `;
            
            detailsPanel.style.display = 'block';
        }
    </script>
</body>
</html>