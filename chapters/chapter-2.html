<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 2 - The Shadow - Aion</title>
    <link rel="stylesheet" href="/styles/full-width.css">
    <link rel="stylesheet" href="/assets/css/ui-consistency.css">
    <style>
        /* Override full-width.css conflicts */
        body {
            margin-left: 0 !important;
        }
        
        /* Ensure main content wrapper exists */
        .main-content {
            margin-left: 250px;
            transition: margin-left 0.3s ease;
            padding: 0;
        }
        
        .main-content.full-width {
            margin-left: 0;
        }
        
        @media (max-width: 768px) {
            .main-content {
                margin-left: 0;
            }
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Georgia, serif;
            background: #000;
            color: #fff;
            line-height: 1.8;
        }
        
        /* Chapter Header */
        .chapter-header {
            padding: 4rem 2rem;
            text-align: center;
            background: linear-gradient(180deg, rgba(212, 175, 55, 0.1) 0%, transparent 100%);
            border-bottom: 1px solid #333;
        }
        
        .chapter-number {
            font-size: 1.2rem;
            color: #D4AF37;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-bottom: 1rem;
        }
        
        .chapter-title {
            font-size: 3rem;
            font-weight: 300;
            color: #fff;
            margin-bottom: 2rem;
        }
        
        .chapter-summary {
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.3rem;
            color: #ccc;
            font-style: italic;
        }
        
        /* Chapter Content */
        .chapter-content {
            width: 100%;
            margin: 0;
            padding: 4rem 4rem;
        }
        
        .section {
            margin-bottom: 3rem;
        }
        
        .section h2 {
            font-size: 2rem;
            color: #D4AF37;
            margin-bottom: 1.5rem;
            font-weight: 300;
        }
        
        .section p {
            font-size: 1.1rem;
            color: #ddd;
            margin-bottom: 1.5rem;
        }
        
        .quote-box {
            background: rgba(212, 175, 55, 0.05);
            border-left: 4px solid #D4AF37;
            padding: 1.5rem;
            margin: 2rem 0;
            font-style: italic;
        }
        
        .quote-box cite {
            display: block;
            margin-top: 1rem;
            color: #888;
            font-style: normal;
            text-align: right;
        }
        
        /* Visualization Container */
        .viz-container {
            margin: 3rem 0;
            padding: 0;
            background: #0a0a0a;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        .viz-container h3 {
            background: rgba(212, 175, 55, 0.1);
            color: #D4AF37;
            padding: 1rem;
            margin: 0;
            font-size: 1.3rem;
            font-weight: 300;
            text-align: center;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }
        
        /* Chapter Navigation */
        .chapter-nav {
            width: 100%;
            margin: 0;
            padding: 3rem 4rem;
            display: flex;
            justify-content: space-between;
            border-top: 1px solid #333;
        }
        
        .nav-link {
            color: #D4AF37;
            text-decoration: none;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            transform: translateX(5px);
        }
        
        .nav-link.prev:hover {
            transform: translateX(-5px);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .chapter-title {
                font-size: 2rem;
            }
            
            .chapter-summary {
                font-size: 1.1rem;
            }
            
            .section h2 {
                font-size: 1.5rem;
            }
            
            .chapter-content {
                padding: 4rem 2rem;
            }
            
            .chapter-nav {
                padding: 3rem 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Chapter Header -->
    <header class="chapter-header">
        <div class="chapter-number">Chapter 2</div>
        <h1 class="chapter-title">The Shadow</h1>
        <p class="chapter-summary">The dark brother hidden in the unconscious</p>
    </header>
    
    <!-- Chapter Content -->
    <main class="chapter-content">
        <section class="section">
            <h2>Overview</h2>
            <p>The shadow represents everything we refuse to acknowledge about ourselves - our repressed weaknesses, desires, and instincts. It's the "dark side" of our personality that the ego has rejected and hidden in the unconscious.</p>
            <p>Jung emphasizes that the shadow isn't inherently evil. It contains vital energy and potential that, when integrated consciously, can enrich the personality and make us whole.</p>
        </section>
        
        <!-- Visualization 1: Shadow Projection -->
        <div class="viz-container">
            <h3>Shadow Projection: Seeing Our Darkness in Others</h3>
            <div id="projection-viz" style="width: 100%; height: 500px; position: relative;">
                <svg id="projection-svg" style="width: 100%; height: 100%;" preserveAspectRatio="xMidYMid meet"></svg>
            </div>
        </div>
        
        <section class="section">
            <h2>Key Concepts</h2>
            <p><strong>Personal Shadow:</strong> The aspects of ourselves that we've repressed or denied. These often appear in dreams as figures of the same sex who embody qualities we dislike.</p>
            <p><strong>Collective Shadow:</strong> Beyond personal repression lies the collective shadow - the dark aspects of human nature itself, accumulated over millennia of human evolution.</p>
            <p><strong>Projection:</strong> We tend to project our shadow onto others, seeing in them the very qualities we cannot accept in ourselves. This mechanism is at the root of much human conflict.</p>
        </section>
        
        <div class="quote-box">
            "Everyone carries a shadow, and the less it is embodied in the individual's conscious life, the blacker and denser it is."
            <cite>- C.G. Jung, Aion</cite>
        </div>
        
        <!-- Visualization 2: Interactive Shadow Work -->
        <div class="viz-container">
            <h3>Interactive Shadow Integration</h3>
            <div id="shadow-integration-viz" style="width: 100%; height: 600px; background: #0a0a0a; border-radius: 8px; position: relative; overflow: hidden;">
                <canvas id="shadowCanvas" style="width: 100%; height: 100%;"></canvas>
                <div id="shadow-info" style="position: absolute; top: 20px; left: 20px; color: #D4AF37; font-size: 16px;">
                    <p>Click to reveal shadow aspects</p>
                </div>
            </div>
        </div>
        
        <section class="section">
            <h2>The Work of Integration</h2>
            <p>Shadow work requires tremendous courage and honesty. It means acknowledging the parts of ourselves we'd rather deny - our anger, greed, weakness, and primitive desires.</p>
            <p>Yet this work is essential for individuation. Only by integrating the shadow can we reclaim the energy it contains and move toward wholeness. The alternative is to remain divided against ourselves, projecting our darkness onto others.</p>
        </section>
        
        <!-- Visualization 3: Shadow Aspects -->
        <div class="viz-container">
            <h3>Common Shadow Aspects</h3>
            <div id="shadow-aspects-viz" style="width: 100%; height: 600px; position: relative;">
                <canvas id="aspects-canvas" style="width: 100%; height: 100%;"></canvas>
            </div>
        </div>
        
        <section class="section">
            <h2>Historical and Cultural Shadows</h2>
            <p>Jung traced shadow manifestations throughout history - in witch hunts, religious persecutions, and ideological conflicts. When groups project their collective shadow onto others, the results can be catastrophic.</p>
            <p>Understanding the shadow is not just personal work but cultural necessity. As Jung warned, "The world hangs on a thin thread, and that thread is the psyche of man."</p>
        </section>
        
        <!-- Visualization 4: Personal vs Collective Shadow -->
        <div class="viz-container">
            <h3>Personal and Collective Shadow Dynamics</h3>
            <div id="shadow-dynamics-viz" style="width: 100%; height: 500px; position: relative;">
                <div id="dynamics-container" style="width: 100%; height: 100%;"></div>
            </div>
        </div>
    </main>
    
    <!-- Chapter Navigation -->
    <nav class="chapter-nav">
        <a href="/chapters/chapter-1.html" class="nav-link prev">
            ← Chapter 1: The Ego
        </a>
        <a href="/chapters/chapter-3.html" class="nav-link next">
            Chapter 3: The Syzygy →
        </a>
    </nav>
    
    <script src="/components/navigation.js"></script>
    <script src="/js/ensure-viz-load.js"></script>
    <script src="/scripts/viz-animations.js"></script>
    
    <!-- Visualization Scripts -->
    <script>
        // Visualization 2: Interactive Shadow Integration
        window.initializeVisualization(function() {
            const canvas = document.getElementById('shadowCanvas');
            const ctx = canvas.getContext('2d');
            const info = document.getElementById('shadow-info');
            
            function resizeCanvas() {
                canvas.width = canvas.offsetWidth;
                canvas.height = canvas.offsetHeight;
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Shadow aspects that emerge when clicked
            const shadowAspects = [
                { name: 'Anger', color: '#8B0000', revealed: false },
                { name: 'Fear', color: '#4B0082', revealed: false },
                { name: 'Shame', color: '#2F4F4F', revealed: false },
                { name: 'Desire', color: '#B22222', revealed: false },
                { name: 'Power', color: '#FFD700', revealed: false },
                { name: 'Vulnerability', color: '#4682B4', revealed: false },
                { name: 'Greed', color: '#228B22', revealed: false },
                { name: 'Jealousy', color: '#32CD32', revealed: false }
            ];
            
            // Position aspects in a circle
            shadowAspects.forEach((aspect, i) => {
                const angle = (Math.PI * 2 / shadowAspects.length) * i;
                const radius = Math.min(canvas.width, canvas.height) * 0.3;
                aspect.x = canvas.width / 2 + Math.cos(angle) * radius;
                aspect.y = canvas.height / 2 + Math.sin(angle) * radius;
                aspect.targetAlpha = 0;
                aspect.currentAlpha = 0;
                aspect.particles = [];
            });
            
            let mouseX = canvas.width / 2;
            let mouseY = canvas.height / 2;
            let clickEffect = { active: false, x: 0, y: 0, radius: 0 };
            
            canvas.addEventListener('mousemove', (e) => {
                const rect = canvas.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
            });
            
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                clickEffect.x = e.clientX - rect.left;
                clickEffect.y = e.clientY - rect.top;
                clickEffect.radius = 0;
                clickEffect.active = true;
                
                // Check if click is near any shadow aspect
                shadowAspects.forEach(aspect => {
                    const dist = Math.hypot(aspect.x - clickEffect.x, aspect.y - clickEffect.y);
                    if (dist < 50 && !aspect.revealed) {
                        aspect.revealed = true;
                        aspect.targetAlpha = 1;
                        updateInfo();
                        
                        // Create particles
                        for (let i = 0; i < 20; i++) {
                            aspect.particles.push({
                                x: aspect.x,
                                y: aspect.y,
                                vx: (Math.random() - 0.5) * 4,
                                vy: (Math.random() - 0.5) * 4,
                                life: 1
                            });
                        }
                    }
                });
            });
            
            function updateInfo() {
                const revealed = shadowAspects.filter(a => a.revealed).length;
                if (revealed === 0) {
                    info.innerHTML = '<p>Click to reveal shadow aspects</p>';
                } else if (revealed < shadowAspects.length) {
                    info.innerHTML = `<p>Shadow Aspects Revealed: ${revealed}/${shadowAspects.length}</p><p style="font-size: 14px; color: #888;">Continue exploring...</p>`;
                } else {
                    info.innerHTML = '<p>All shadow aspects revealed!</p><p style="font-size: 14px; color: #888;">Integration begins with recognition</p>';
                }
            }
            
            function draw() {
                // Fade effect
                ctx.fillStyle = 'rgba(10, 10, 10, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw center (conscious ego)
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                ctx.beginPath();
                ctx.arc(centerX, centerY, 60, 0, Math.PI * 2);
                ctx.fillStyle = '#D4AF37';
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.fillStyle = '#000';
                ctx.font = 'bold 16px Georgia';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('EGO', centerX, centerY);
                
                // Draw connection lines to shadow aspects
                shadowAspects.forEach(aspect => {
                    if (aspect.currentAlpha > 0.1) {
                        ctx.beginPath();
                        ctx.moveTo(centerX, centerY);
                        ctx.lineTo(aspect.x, aspect.y);
                        ctx.strokeStyle = `rgba(136, 136, 136, ${aspect.currentAlpha * 0.3})`;
                        ctx.lineWidth = 1;
                        ctx.stroke();
                    }
                });
                
                // Draw shadow aspects
                shadowAspects.forEach(aspect => {
                    // Update alpha
                    aspect.currentAlpha += (aspect.targetAlpha - aspect.currentAlpha) * 0.05;
                    
                    if (aspect.currentAlpha > 0.01) {
                        // Shadow circle
                        ctx.beginPath();
                        ctx.arc(aspect.x, aspect.y, 40, 0, Math.PI * 2);
                        ctx.fillStyle = aspect.color;
                        ctx.globalAlpha = aspect.currentAlpha * 0.8;
                        ctx.fill();
                        ctx.globalAlpha = 1;
                        
                        // Border
                        ctx.strokeStyle = `rgba(255, 255, 255, ${aspect.currentAlpha})`;
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        
                        // Text
                        ctx.fillStyle = `rgba(255, 255, 255, ${aspect.currentAlpha})`;
                        ctx.font = '14px Georgia';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(aspect.name, aspect.x, aspect.y);
                    }
                    
                    // Update and draw particles
                    aspect.particles = aspect.particles.filter(p => {
                        p.x += p.vx;
                        p.y += p.vy;
                        p.life -= 0.02;
                        
                        if (p.life > 0) {
                            ctx.beginPath();
                            ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
                            ctx.fillStyle = `rgba(212, 175, 55, ${p.life})`;
                            ctx.fill();
                            return true;
                        }
                        return false;
                    });
                });
                
                // Draw click effect
                if (clickEffect.active) {
                    ctx.beginPath();
                    ctx.arc(clickEffect.x, clickEffect.y, clickEffect.radius, 0, Math.PI * 2);
                    ctx.strokeStyle = `rgba(212, 175, 55, ${1 - clickEffect.radius / 100})`;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    clickEffect.radius += 3;
                    if (clickEffect.radius > 100) {
                        clickEffect.active = false;
                    }
                }
                
                // Draw mouse follower
                const dx = mouseX - centerX;
                const dy = mouseY - centerY;
                const dist = Math.hypot(dx, dy);
                if (dist > 70) {
                    const angle = Math.atan2(dy, dx);
                    const x = centerX + Math.cos(angle) * 70;
                    const y = centerY + Math.sin(angle) * 70;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 5, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                    ctx.fill();
                }
                
                requestAnimationFrame(draw);
            }
            
            draw();
        });
        
        // Visualization 1: Shadow Projection
        window.initializeVisualization(function() {
            const svg = document.getElementById('projection-svg');
            const width = 800;
            const height = 500;
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
            
            // Create gradient for shadow
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const gradient = document.createElementNS('http://www.w3.org/2000/svg', 'linearGradient');
            gradient.setAttribute('id', 'shadowGradient');
            gradient.innerHTML = `
                <stop offset="0%" style="stop-color:#8B008B;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#4B0082;stop-opacity:0.5" />
            `;
            defs.appendChild(gradient);
            svg.appendChild(defs);
            
            // Person 1 (projector)
            const person1 = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            person1.innerHTML = `
                <circle cx="200" cy="250" r="40" fill="#D4AF37" />
                <text x="200" y="255" text-anchor="middle" fill="#000" font-size="14">ME</text>
                <text x="200" y="320" text-anchor="middle" fill="#888" font-size="12">Conscious Self</text>
            `;
            svg.appendChild(person1);
            
            // Shadow behind person 1
            const shadow1 = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
            shadow1.setAttribute('cx', '150');
            shadow1.setAttribute('cy', '250');
            shadow1.setAttribute('rx', '30');
            shadow1.setAttribute('ry', '60');
            shadow1.setAttribute('fill', 'url(#shadowGradient)');
            shadow1.setAttribute('opacity', '0.7');
            svg.insertBefore(shadow1, person1);
            
            // Projection arrow
            const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            arrow.innerHTML = `
                <path d="M 240 250 Q 400 200 560 250" fill="none" stroke="#8B008B" stroke-width="3" stroke-dasharray="5,5" opacity="0.6"/>
                <polygon points="560,250 550,245 550,255" fill="#8B008B" opacity="0.6"/>
                <text x="400" y="190" text-anchor="middle" fill="#8B008B" font-size="14">PROJECTION</text>
            `;
            svg.appendChild(arrow);
            
            // Person 2 (projection target)
            const person2 = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            person2.innerHTML = `
                <circle cx="600" cy="250" r="40" fill="#888" />
                <text x="600" y="255" text-anchor="middle" fill="#fff" font-size="14">OTHER</text>
                <text x="600" y="320" text-anchor="middle" fill="#888" font-size="12">Projection Screen</text>
            `;
            svg.appendChild(person2);
            
            // Shadow projection on person 2
            const shadowProjection = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
            shadowProjection.setAttribute('cx', '600');
            shadowProjection.setAttribute('cy', '250');
            shadowProjection.setAttribute('rx', '50');
            shadowProjection.setAttribute('ry', '50');
            shadowProjection.setAttribute('fill', '#8B008B');
            shadowProjection.setAttribute('opacity', '0.3');
            svg.insertBefore(shadowProjection, person2);
            
            // Qualities text
            const qualities = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            qualities.innerHTML = `
                <text x="150" y="180" text-anchor="middle" fill="#8B008B" font-size="12" opacity="0.8">Denied:</text>
                <text x="150" y="160" text-anchor="middle" fill="#8B008B" font-size="11" opacity="0.8">Anger</text>
                <text x="150" y="145" text-anchor="middle" fill="#8B008B" font-size="11" opacity="0.8">Greed</text>
                <text x="150" y="130" text-anchor="middle" fill="#8B008B" font-size="11" opacity="0.8">Weakness</text>
                
                <text x="600" y="180" text-anchor="middle" fill="#8B008B" font-size="12">"They are:"</text>
                <text x="600" y="160" text-anchor="middle" fill="#8B008B" font-size="11">Angry</text>
                <text x="600" y="145" text-anchor="middle" fill="#8B008B" font-size="11">Greedy</text>
                <text x="600" y="130" text-anchor="middle" fill="#8B008B" font-size="11">Weak</text>
            `;
            svg.appendChild(qualities);
            
            // Title
            const title = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            title.setAttribute('x', width/2);
            title.setAttribute('y', 50);
            title.setAttribute('text-anchor', 'middle');
            title.setAttribute('fill', '#D4AF37');
            title.setAttribute('font-size', '18');
            title.textContent = 'How We Project Our Shadow Onto Others';
            svg.appendChild(title);
            
            // Animate
            let pulseTime = 0;
            function animateProjection() {
                pulseTime += 0.05;
                const scale = 1 + Math.sin(pulseTime) * 0.1;
                shadowProjection.setAttribute('transform', `scale(${scale})`);
                shadowProjection.setAttribute('transform-origin', '600 250');
                
                const opacity = 0.3 + Math.sin(pulseTime) * 0.1;
                arrow.setAttribute('opacity', opacity);
                
                requestAnimationFrame(animateProjection);
            }
            animateProjection();
        });
        
        // Visualization 3: Shadow Aspects
        window.initializeVisualization(function() {
            const canvas = document.getElementById('aspects-canvas');
            const ctx = canvas.getContext('2d');
            
            function resizeCanvas() {
                const dpr = window.devicePixelRatio || 1;
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
                canvas.style.width = rect.width + 'px';
                canvas.style.height = rect.height + 'px';
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            const aspects = [
                { name: 'Rage', color: '#FF0000', x: 0, y: 0, size: 40 },
                { name: 'Greed', color: '#FFD700', x: 0, y: 0, size: 35 },
                { name: 'Lust', color: '#FF1493', x: 0, y: 0, size: 30 },
                { name: 'Envy', color: '#00FF00', x: 0, y: 0, size: 35 },
                { name: 'Pride', color: '#9370DB', x: 0, y: 0, size: 45 },
                { name: 'Fear', color: '#000080', x: 0, y: 0, size: 40 },
                { name: 'Shame', color: '#8B4513', x: 0, y: 0, size: 35 },
                { name: 'Weakness', color: '#696969', x: 0, y: 0, size: 30 }
            ];
            
            // Initialize positions
            aspects.forEach((aspect, i) => {
                const angle = (i / aspects.length) * Math.PI * 2;
                const radius = 150;
                const rect = canvas.getBoundingClientRect();
                aspect.x = rect.width / 2 + Math.cos(angle) * radius;
                aspect.y = rect.height / 2 + Math.sin(angle) * radius;
                aspect.vx = (Math.random() - 0.5) * 2;
                aspect.vy = (Math.random() - 0.5) * 2;
            });
            
            function drawAspects() {
                const rect = canvas.getBoundingClientRect();
                ctx.fillStyle = '#0a0a0a';
                ctx.fillRect(0, 0, rect.width, rect.height);
                
                // Draw center
                ctx.beginPath();
                ctx.arc(rect.width / 2, rect.height / 2, 60, 0, Math.PI * 2);
                ctx.fillStyle = '#D4AF37';
                ctx.fill();
                ctx.fillStyle = '#000';
                ctx.font = 'bold 20px Georgia';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('EGO', rect.width / 2, rect.height / 2);
                
                // Draw shadow aspects
                aspects.forEach(aspect => {
                    // Update position
                    aspect.x += aspect.vx;
                    aspect.y += aspect.vy;
                    
                    // Bounce off edges
                    if (aspect.x < aspect.size || aspect.x > rect.width - aspect.size) {
                        aspect.vx *= -1;
                    }
                    if (aspect.y < aspect.size || aspect.y > rect.height - aspect.size) {
                        aspect.vy *= -1;
                    }
                    
                    // Keep away from center
                    const dx = aspect.x - rect.width / 2;
                    const dy = aspect.y - rect.height / 2;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 100) {
                        aspect.vx += (dx / dist) * 0.5;
                        aspect.vy += (dy / dist) * 0.5;
                    }
                    
                    // Draw shadow aspect
                    ctx.beginPath();
                    ctx.arc(aspect.x, aspect.y, aspect.size, 0, Math.PI * 2);
                    ctx.fillStyle = aspect.color;
                    ctx.globalAlpha = 0.7;
                    ctx.fill();
                    ctx.globalAlpha = 1;
                    
                    // Draw label
                    ctx.fillStyle = '#fff';
                    ctx.font = '14px Georgia';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(aspect.name, aspect.x, aspect.y);
                });
                
                // Draw title
                ctx.fillStyle = '#888';
                ctx.font = '16px Georgia';
                ctx.textAlign = 'center';
                ctx.fillText('Shadow aspects orbit the conscious ego, seeking integration', rect.width / 2, rect.height - 30);
                
                requestAnimationFrame(drawAspects);
            }
            
            drawAspects();
        });
        
        // Visualization 4: Personal vs Collective Shadow
        window.initializeVisualization(function() {
            const container = document.getElementById('dynamics-container');
            container.innerHTML = `
                <svg viewBox="0 0 800 500" style="width: 100%; height: 100%;">
                    <defs>
                        <pattern id="personalPattern" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse">
                            <circle cx="10" cy="10" r="2" fill="#8B008B" opacity="0.5"/>
                        </pattern>
                        <pattern id="collectivePattern" x="0" y="0" width="30" height="30" patternUnits="userSpaceOnUse">
                            <rect x="0" y="0" width="30" height="30" fill="#4B0082" opacity="0.2"/>
                            <circle cx="15" cy="15" r="5" fill="#4B0082" opacity="0.3"/>
                        </pattern>
                    </defs>
                    
                    <!-- Personal Shadow Section -->
                    <g id="personalShadow">
                        <rect x="50" y="100" width="300" height="300" fill="url(#personalPattern)" stroke="#8B008B" stroke-width="2"/>
                        <text x="200" y="80" text-anchor="middle" fill="#8B008B" font-size="18">Personal Shadow</text>
                        
                        <text x="200" y="130" text-anchor="middle" fill="#ccc" font-size="14">Individual Repressions:</text>
                        <text x="200" y="160" text-anchor="middle" fill="#aaa" font-size="12">• Childhood traumas</text>
                        <text x="200" y="180" text-anchor="middle" fill="#aaa" font-size="12">• Rejected traits</text>
                        <text x="200" y="200" text-anchor="middle" fill="#aaa" font-size="12">• Denied desires</text>
                        <text x="200" y="220" text-anchor="middle" fill="#aaa" font-size="12">• Personal fears</text>
                        <text x="200" y="240" text-anchor="middle" fill="#aaa" font-size="12">• Family patterns</text>
                        
                        <circle cx="200" cy="300" r="40" fill="#D4AF37" opacity="0.8"/>
                        <text x="200" y="305" text-anchor="middle" fill="#000" font-size="16">Individual</text>
                    </g>
                    
                    <!-- Collective Shadow Section -->
                    <g id="collectiveShadow">
                        <rect x="450" y="100" width="300" height="300" fill="url(#collectivePattern)" stroke="#4B0082" stroke-width="2"/>
                        <text x="600" y="80" text-anchor="middle" fill="#4B0082" font-size="18">Collective Shadow</text>
                        
                        <text x="600" y="130" text-anchor="middle" fill="#ccc" font-size="14">Humanity's Dark Heritage:</text>
                        <text x="600" y="160" text-anchor="middle" fill="#aaa" font-size="12">• War & violence</text>
                        <text x="600" y="180" text-anchor="middle" fill="#aaa" font-size="12">• Tribal hatred</text>
                        <text x="600" y="200" text-anchor="middle" fill="#aaa" font-size="12">• Mass projections</text>
                        <text x="600" y="220" text-anchor="middle" fill="#aaa" font-size="12">• Cultural taboos</text>
                        <text x="600" y="240" text-anchor="middle" fill="#aaa" font-size="12">• Archetypal evil</text>
                        
                        <circle cx="600" cy="300" r="40" fill="#D4AF37" opacity="0.8"/>
                        <text x="600" y="305" text-anchor="middle" fill="#000" font-size="16">Collective</text>
                    </g>
                    
                    <!-- Connection -->
                    <path d="M 350 250 L 450 250" stroke="#666" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="400" y="240" text-anchor="middle" fill="#888" font-size="12">Interconnected</text>
                    
                    <!-- Title -->
                    <text x="400" y="30" text-anchor="middle" fill="#D4AF37" font-size="20">The Two Levels of Shadow</text>
                    
                    <!-- Description -->
                    <text x="400" y="450" text-anchor="middle" fill="#888" font-size="14">
                        Personal shadows arise from individual experience; collective shadows from human history
                    </text>
                </svg>
            `;
            
            // Add hover effects
            const personal = container.querySelector('#personalShadow');
            const collective = container.querySelector('#collectiveShadow');
            
            personal.addEventListener('mouseenter', () => {
                personal.style.opacity = '1';
                collective.style.opacity = '0.5';
            });
            
            collective.addEventListener('mouseenter', () => {
                collective.style.opacity = '1';
                personal.style.opacity = '0.5';
            });
            
            container.addEventListener('mouseleave', () => {
                personal.style.opacity = '1';
                collective.style.opacity = '1';
            });
        });
    </script>
</body>
</html>