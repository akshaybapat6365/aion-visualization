<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chapter 13 Compatibility Redirect</title>
</head>
<body data-compat-redirect="chapter-shell">
  <p>Redirecting to unified chapter routeâ€¦</p>
  <script>
    (function () {
      var chapterId = 'ch13';
      var variant = 'standard';
      var target = '/journey/chapter/' + chapterId + '?legacy=' + variant;
      var usage = {
        event: 'legacy_chapter_redirect',
        chapterId: chapterId,
        variant: variant,
        from: window.location.pathname,
        at: new Date().toISOString()
      };

      try {
        var key = 'aion-legacy-chapter-redirect-log';
        var existing = JSON.parse(localStorage.getItem(key) || '[]');
        existing.push(usage);
        localStorage.setItem(key, JSON.stringify(existing.slice(-100)));
      } catch (error) {
        console.warn('Could not persist legacy redirect log', error);
      }

      try {
        if (navigator.sendBeacon) {
          navigator.sendBeacon('/compatibility/legacy-chapter-usage', JSON.stringify(usage));
        }
      } catch (error) {
        console.warn('Could not beacon legacy redirect usage', error);
      }

      console.info('[compat] Redirecting legacy chapter URL', usage);
      window.location.replace(target);
    })();
  </script>
</body>
</html>
